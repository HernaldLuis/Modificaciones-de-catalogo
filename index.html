<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cat√°logo de Habitaciones</title>
  <style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background-image: url('https://raw.githubusercontent.com/HernaldLuis/Catalogo-Paradisus-Habitaciones/main/Portada.jpeg');
  background-size: cover;
  background-position: center;
  background-color: #f0f0f0; /* fallback si la imagen no carga */
 } 
    h1 {
      text-align: center;
      padding: 20px;
 }

.btn-volver {
  display: inline-block;
  padding: 8px 14px;
  background: linear-gradient(135deg, #6b4226, #a47148); /* Tonos tierra */
  color: white;
  font-weight: bold;
  text-transform: uppercase;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

.btn-volver:hover {
  background: linear-gradient(135deg, #a47148, #6b4226);
  transform: scale(1.05);
}

.btn-volver:active {
  transform: scale(0.97);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.titulo-catalogo {
  display: flex;
  align-items: center;
  justify-content: center; /* Centra texto y logo */
  gap: 0.75rem;
  flex-wrap: wrap; /* Para que en m√≥vil no se corte raro */

  font-family: 'Playfair Display', serif;
  font-size: 2rem;
  font-weight: 700;
  letter-spacing: 0.5px;
  color: #111;
  text-align: center;
  margin: 1rem 0 1.5rem;
  text-shadow: 0 2px 4px rgba(0,0,0,0.25);
  position: relative;
}

.titulo-catalogo span {
  display: inline-block;
}

.titulo-catalogo::after {
  content: '';
  display: block;
  width: 90px;
  height: 3px;
  margin: 0.5rem auto 0;
  background: #111;
  border-radius: 2px;
  position: absolute;
  bottom: -0.5rem;
  left: 50%;
  transform: translateX(-50%);
}

.logo-catalogo {
  height: 90px; /* un poco m√°s grande */
  width: auto;
}


@media (max-width: 600px) {
  .logo-catalogo {
    height: 62px; /* sigue siendo m√°s grande que el texto pero no exagerado */
  }
}

  .zona-desplazable,
.zona-desplazable * {
  user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
}

.zona-desplazable {
  cursor: grab;

  touch-action: pan-x pinch-zoom;
  -webkit-overflow-scrolling: touch;
}

.zona-desplazable.arrastrando {
  cursor: grabbing;
}


.mensaje-inicial {
  text-align: center;
  font-weight: bold;
  font-size: 16px;
  color: #444;
  padding: 10px;
}

    .zona-desplazable {
      display: flex;
      flex-direction: row;
      gap: 40px;
      padding: 20px;
      overflow-x: auto;
      overflow-y: hidden;
      scroll-behavior: smooth;
background: transparent;  /* ¬°ESTE COMANDO HACE QUE EL CONTENEDOR DEL CROQUIS SEA TRASNPARENTE! */
border-top: none;
border-bottom: none;
      width: 100vw;
      box-sizing: border-box;
      white-space: nowrap;
    }

.torre {
  flex: 0 0 auto;
  width: max-content;
  min-width: 420px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  background-color: rgba(0, 0, 0, 0.5); /* <- Fondo oscuro transparente */
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  color: white; /* Para que el texto sea legible */
}

    .torre-2 {
  margin-top: 145px;
}

   .torre-3 {
  margin-top: 205px;
}

       .torre-4 {
  margin-top: 100px;

}

    .torre h2 {
      text-align: center;
      background: #005baa;
      color: white;
      margin: 0;
      padding: 10px;
      border-radius: 6px;
    }

  /* <-- ESTO ES EL PANEL INFERIOR DONDE METEMOS IMAGENES Y DESCRIPCION */
.panel-inferior {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.95);
  padding: 40px 50px;
  border-radius: 18px;
  box-shadow: 0 12px 28px rgba(0,0,0,0.35);
  z-index: 9999;
  display: none;
  max-width: 98vw;
  width: 1000px; /* antes 600px, luego 800px */
  color: black;
}


  .contenido-panel {
    position: relative;
  }

  .cerrar-panel {
    position: absolute;
    top: -15px;
    right: -15px;
    background: #ff4d4d;
    color: white;
    font-weight: bold;
    padding: 5px 12px;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
  }

  .galeria-imagenes {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 15px;
    flex-wrap: wrap;
  }

  .galeria-imagenes img {
    width: 180px; /* ESTE TAMA√ëO CONTROLA LAS IMAGENES DEL PANEL DE CONSULTA */
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }


.galeria-habitacion {
  display: flex;
  justify-content: center;
  gap: 15px;
  flex-wrap: wrap; /* esto permite que salten a otra fila */
  margin-top: 20px;
}

.bloque-imagen {
  text-align: center;
}

.bloque-imagen img {
  width: 280px; /* antes 200px ‚Üí luego 240px */
  border-radius: 10px;
  transition: transform 0.3s ease;
  cursor: zoom-in;
}

.bloque-imagen img:hover {
  transform: scale(1.2);
  z-index: 10;
}

#zoom-overlay {
  display: none; /* ser√° activado con JS */
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.7);
  justify-content: center;
  align-items: center;
  z-index: 11000;
}

#zoom-overlay img {
  max-width: 80%;
  max-height: 80%;
  border-radius: 12px;
  box-shadow: 0 0 25px rgba(255,255,255,0.3);
  transition: transform 0.3s ease;
}




#zoom-img {
  max-width: 90%;
  max-height: 80%;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0,0,0,0.8);
  transition: transform 0.3s;
}

#zoom-close {
  position: absolute;
  top: 25px;
  right: 35px;
  font-size: 2rem;
  color: white;
  cursor: pointer;
  z-index: 10001;
}


.visor-oculto {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.85);
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

.visor-oculto img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 10px;
  box-shadow: 0 0 15px rgba(255,255,255,0.3);
  transition: transform 0.3s;
  cursor: zoom-out;
}



.piso {
  display: flex;
  gap: 5px;
  flex-wrap: nowrap; /* <-- evita que se baje */
   width: max-content;  /* ‚¨ÖÔ∏è esto fuerza a que se expanda lo necesario */
}

    .habitacion-btn {        
      padding: 6px 12px;
      background-color:#4caf50 ;   /*üî• Estas seccion cambiar el color de las habitaciones vacias*/
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .habitacion-btn:hover {
      background-color: #388e3c ; /*üî• Estas seccion cambiar el color de las habitaciones cuando pones el cursor*/
    }

    .habitacion-btn.disponible {  
  background-color:#e07b17;      /*üî• Estas seccion cambiar el color de las habotaciones disponiblesx */
  color: white;
  border: 2px solid #0056b3;
  font-weight: bold;
}

.habitacion-btn.disponible:hover {
  background-color: #0056b3;
}

    /* Tipo K - King */
.habitacion-btn.tipo-k {
  background-color: #6b9ac4;  /* Azul suave */
  border: 2px solid #3e5e8c;
}

/* Tipo D - Doble */
.habitacion-btn.tipo-d {
  background-color: #f4a261;  /* Naranja suave */
  border: 2px solid #b76b3d;
}


    .pasillo {
      width: 100%;
      border-top: 2px dashed #aaa;
      margin: 12px 0;
    }     

/* Estilo unificado para los bloques de ‚Äújard√≠n / pasillo‚Äù */
.jardin-simulada,
.jardin-ficticio {
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 380px;
  width: max-content;
  box-sizing: border-box;

  background: linear-gradient(to right, #d2b48c, #deb887, #f5deb3);
  color: #5c3a21;
  font-weight: bold;
  border: 2px dashed #c2a476;
  border-radius: 8px;
  margin-bottom: 8px;
  font-size: 14px;
  box-shadow: inset 0 0 5px rgba(92, 58, 33, 0.3),
              0 2px 6px rgba(0, 0, 0, 0.15);
  padding: 10px 40px 10px 10px; /* extra espacio en la derecha */
}

      /* (PANTALLA FLOTANTE) */
.mensaje-flotante {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(0, 0, 0, 0.85);
  color: #fff;
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 1rem;
  z-index: 9999;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  animation: flotanteFadeIn 0.4s ease;
}

@keyframes flotanteFadeIn {
  from { opacity: 0; transform: translateX(-50%) translateY(20px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

.contenido-inferior {
  max-width: 100%;
  overflow-wrap: break-word; /* fuerza salto de l√≠nea si es necesario */
  word-wrap: break-word;
  white-space: normal; /* permite el salto de l√≠nea */
  font-size: 1.1rem;
  line-height: 1.6;
  padding: 10px;
}

.contenido-inferior a {
  display: inline;
  word-break: break-word;
}


.conector-conectadas {
  display: inline-block;
  color: white;            /* Color blanco */
  font-size: 12px;         /* M√°s corta visualmente */
  font-weight: bold;
  margin: 0 2px;           /* Muy poco espacio entre botones */
  line-height: 30px;       /* Alineaci√≥n vertical */
  pointer-events: none;    /* No clickeable, solo visual */
}

  .habitacion-btn .tipo-cama {   /* (Controla la letra por el tipo de cama de cada habitacion*/
  display: block;
  font-size: 12px;
  font-weight: normal;
  color: #f0f0f0;
  margin-top: 2px;
}

  .habitacion-btn div {
  line-height: 1.2;
}

.habitacion-btn div:nth-child(2) {
  font-size: 0.75rem;
  margin-top: 2px;
  opacity: 0.85;
}

/* ==== Panel de Filtro Categor√≠as - Estilo Premium ==== */
/* === PANEL DE FILTRO POR CATEGOR√çA - ULTRA PREMIUM === */
.panel-filtro-categoria {
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  gap: 1rem;
  align-items: center;
  flex-wrap: wrap;
  padding: 0.9rem 1.5rem;

  background: rgba(255, 255, 255, 0.8);
  background: linear-gradient(135deg, rgba(255,255,255,0.85), rgba(245,245,245,0.85));
  backdrop-filter: blur(10px) saturate(180%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 0 0 18px 18px;

  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

/* Etiqueta */
.panel-filtro-categoria label {
  font-weight: 600;
  font-size: 0.95rem;
  color: #333;
  letter-spacing: 0.5px;
}

/* Select elegante */
.panel-filtro-categoria select {
  padding: 0.45rem 1.2rem;
  font-size: 0.95rem;
  font-weight: 500;
  color: #333;
  border: 1px solid rgba(0,0,0,0.1);
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(4px);
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
  transition: all 0.3s ease;
}
.panel-filtro-categoria select:hover {
  border-color: #00aaff;
  box-shadow: 0 0 8px rgba(0,170,255,0.3);
}
.panel-filtro-categoria select:focus {
  outline: none;
  border-color: #0077cc;
  box-shadow: 0 0 12px rgba(0,119,204,0.4);
}

/* Bot√≥n Limpiar */
.panel-filtro-categoria button {
  padding: 0.45rem 1.2rem;
  font-size: 0.9rem;
  font-weight: 600;
  color: #fff;
  background: linear-gradient(135deg, #00aaff, #0077cc);
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
}
.panel-filtro-categoria button:hover {
  background: linear-gradient(135deg, #0099dd, #0066aa);
  box-shadow: 0 4px 12px rgba(0,170,255,0.4);
}

/* Contador */
.panel-filtro-categoria .contador-categoria {
  margin-left: auto;
  font-size: 0.9rem;
  font-weight: 500;
  color: #444;
}
.panel-filtro-categoria .contador-categoria strong {
  color: #0077cc;
}

/* Animaci√≥n de habitaciones activas */
.habitacion-btn.filtro-activo {
  animation: boomCategoria .35s ease, latidoHabitacion 1.4s ease-in-out .35s infinite;
  will-change: transform, box-shadow;
  border-radius: 8px;
}
.habitacion-btn.filtro-inactivo {
  opacity: 0.28;
  filter: grayscale(.2) brightness(0.8);
}
@keyframes boomCategoria {
  0% { transform: scale(1); }
  60% { transform: scale(1.1); }
  100% { transform: scale(1); }
}
@keyframes latidoHabitacion {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 0 0 rgba(0,170,255,0);
  }
  50% {
    transform: scale(1.06);
    box-shadow: 0 0 16px rgba(0,170,255,0.45);
  }
}
/* Fondo oscuro */
.modal-mejoras {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

/* Activo */
.modal-mejoras.activo {
  opacity: 1;
  pointer-events: all;
}

/* Caja del modal */
.modal-contenido{
  box-sizing: border-box;
  background: #fff;
  padding: 1.25rem;
  border-radius: 12px;
  max-width: min(92vw, 520px);
  width: calc(100% - 2rem);
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  text-align: left;
  overflow-wrap: anywhere;
  word-break: break-word;
  white-space: normal;
  animation: aparecerModal .4s ease;
}

.modal-contenido ul { margin: 0 0 .5rem; padding-left: 1.1rem; }
.modal-contenido li { margin-bottom: .35rem; }

@media (max-width: 480px) {
  
}

/* T√≠tulo */
.modal-contenido h2 {
  font-family: 'Playfair Display', serif; /* si la quieres, si no, qu√≠tala */
  font-size: 1.4rem;
  margin-bottom: 1rem;

  /* üëâ a√±ade: */
  line-height: 1.3;
  text-align: center;
  overflow-wrap: anywhere;   /* evita desborde por palabras/largos */
  word-break: break-word;    /* respaldo para navegadores viejos */
}

/* Lista */
.modal-contenido ul {
  padding-left: 1.2rem;
  margin-bottom: 1.5rem;
}
.modal-contenido li {
  margin-bottom: 0.5rem;
}

/* Bot√≥n */
.modal-contenido button {
  background: linear-gradient(135deg, #00aaff, #0077cc);
  color: #fff;
  border: none;
  padding: 0.5rem 1.2rem;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
.modal-contenido button:hover {
  background: linear-gradient(135deg, #0099dd, #0066aa);
}

/* Animaci√≥n */
@keyframes aparecerModal {
  0% { transform: scale(0.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

  /* (ESTO CORRESPNDE AL PANEL DE LAS IMAGENES DE COSULTa */

  
/* === Anexos (no altera tu estilo base) === */
.panel-filtro-categoria .chk {
  display: inline-flex; align-items: center; gap: .35rem;
  padding: 4px 6px; border-radius: 8px; background: rgba(255,255,255,0.6);
}
.totales-tabla table{
  width: 100%; border-collapse: collapse; background: rgba(255,255,255,0.88);
  border-radius: 12px; overflow: hidden; box-shadow: 0 4px 14px rgba(0,0,0,.08);
}
.totales-tabla th, .totales-tabla td{
  padding: .5rem .7rem; border-bottom: 1px solid rgba(0,0,0,.06); text-align: center;
}
.totales-tabla thead th{ background: linear-gradient(135deg, #00aaff22, #0077cc22); font-weight: 700; }
.totales-tabla tbody tr:last-child td{ border-bottom: 0; }

/* --- Video en detalle de habitaci√≥n (handicap) --- */
.video-habitacion{ position:absolute; top:16px; right:16px; width:520px; max-width:44%; background:#fff; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,.18); overflow:hidden; }
.video-ratio iframe, .video-ratio video{ position:absolute; inset:0; width:100%; height:100%; border:0; object-fit:contain; }
.video-ratio video{ object-fit: contain; background:#000; }
.contenido-inferior{ position:relative; }
.contenido-inferior.con-video{ padding-right: calc(var(--video-width, 360px) + 24px); transition: padding-right .2s ease; } /* tarjeta blanca del detalle */
@media (max-width: 900px){
  .contenido-inferior.con-video{ padding-right:0; }
  .video-habitacion{ position:static; width:100%; max-width:100%; margin-bottom:12px; }
}


/* === Zoom de video === */
.video-zoom-overlay{
  display:none; position:fixed; inset:0; z-index:10000;
  background:rgba(0,0,0,.85); align-items:center; justify-content:center;
}
.video-zoom-overlay.activo{ display:flex; }
#zoom-video{ max-width:96vw; max-height:92vh; border-radius:12px; background:#000; outline:0; }


/* Bot√≥n de reporte PDF */
.btn-reporte{
  display:inline-block; padding:.45rem .8rem; border-radius:10px;
  background:#0ea5e9; color:#fff; text-decoration:none; font-weight:600;
  box-shadow:0 2px 8px rgba(0,0,0,.12); margin-left:.5rem;
}
.btn-reporte:hover{ filter:brightness(.95); }

/* === Ajuste puntual: reducir 25% el video Handicap anclado arriba-derecha === */
#video-habitacion, .video-habitacion{
  transform: scale(0.65);
  transform-origin: top right;
}
/* (Opcional) Si se necesita diferente escala por viewport, ajustar aqu√≠ con media queries */


/* === Ajustes de texto y flujo bajo el video === */
.contenido-inferior p,
.contenido-inferior h3 { 
  text-align: left;
}

/* Reservar espacio a la derecha para que el texto no quede debajo del video */
.contenido-inferior {
  padding-right: 364px; /* ‚âà 520px * 0.65 + holgura */
}

/* Opcional: en pantallas estrechas, reducir el padding para no comer demasiado ancho */
@media (max-width: 600px){
  .contenido-inferior { padding-right: 40vw; }
}


/* === Fix desbordamiento de tercera imagen en la galer√≠a === */
.galeria-habitacion {
  justify-content: flex-start; /* alinear a la izquierda */
}

/* Garantizar que las im√°genes nunca excedan su bloque */
.bloque-imagen {
  flex: 0 0 auto;
}
.bloque-imagen img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Si el ancho fijo de 280px genera corte, permite reducir levemente en pantallas medias */
@media (max-width: 1024px){
  .bloque-imagen img { width: 260px; }
}
@media (max-width: 800px){
  .bloque-imagen img { width: 220px; }
}


/* === Ajuste: reservar espacio solo para los primeros textos; galer√≠a a ancho completo === */
/* Quita el padding-right global previo en el contenedor */
.contenido-inferior { padding-right: 0 !important; }

/* Aplica el espacio a la derecha SOLO al t√≠tulo y a los primeros 8 <p> (hasta "Caracter√≠sticas") */
.contenido-inferior > h3,
.contenido-inferior > p:nth-of-type(-n+8){
  padding-right: 364px; /* ‚âà ancho del video escalado */
}
@media (max-width: 600px){
  .contenido-inferior > h3,
  .contenido-inferior > p:nth-of-type(-n+8){
    padding-right: 40vw;
  }
}

/* Galer√≠a responsive: que ninguna imagen se desborde */
.galeria-habitacion { justify-content: flex-start; }
.bloque-imagen { width: min(100%, 360px); }
.bloque-imagen img { width: 100%; height: auto; display: block; }


/* === Galer√≠a: 3 im√°genes corridas y alineadas en una fila === */
.galeria-habitacion{
  display: grid !important;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  align-items: start;
  justify-items: center;
  width: 100%;
}

.bloque-imagen{ 
  width: 100% !important; 
  max-width: none !important;
}

.bloque-imagen img{
  width: 100%;
  height: auto;
  display: block;
}

/* Si el viewport se vuelve muy estrecho, mantenemos 3 columnas con scroll horizontal
   (solo si fuera necesario). Descomenta si quieres forzar 3 en m√≥vil tambi√©n.
@media (max-width: 720px){
  .galeria-habitacion{ 
    display: grid !important;
    grid-auto-flow: column;
    grid-auto-columns: 80vw;
    overflow-x: auto;
    grid-template-columns: none;
  }
}
*/


/* === HK Inventario: botones + modal login + inventario principal === */
.btn-inventario{
  position:absolute; top:10px; right:10px;
  display:inline-flex; align-items:center; gap:.35rem;
  padding:8px 16px; border-radius:999px; border:none;
  background:linear-gradient(135deg,#c9a14a,#8a5a2b);
  color:#fff; font-weight:800; cursor:pointer;
  box-shadow:0 8px 18px rgba(0,0,0,.25);
}
.btn-inventario:hover{ filter:brightness(.97); }

.btn-logout{
  position:fixed; top:10px; right:12px; z-index:10050;
  padding:6px 12px; border-radius:999px; border:none;
  background:#0ea5e9; color:#fff; font-weight:700; cursor:pointer;
  box-shadow:0 6px 14px rgba(0,0,0,.18);
}
.btn-logout:hover{ filter:brightness(.95); }

/* Modal visual del PIN (hkpin2) */
.hkpin-overlay{
  position: fixed; inset:0; display:none; align-items:center; justify-content:center;
  background: rgba(0,0,0,.35); backdrop-filter: blur(4px); z-index: 10060;
}
.hkpin-overlay.activo{ display:flex; }
.hkpin-modal{
  width: min(420px, 92vw); background:#fff; border-radius: 16px; padding: 20px 18px;
  box-shadow: 0 30px 60px rgba(0,0,0,.25);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}
.hkpin-modal h3{ margin: 0 0 4px; font-size: 18px; font-weight: 800; }
.hkpin-sub{ margin: 0 0 12px; color:#444; font-size: 13px; }
.hkpin-field{ display:flex; align-items:center; gap:6px; border:1px solid rgba(0,0,0,.12); padding:6px 8px; border-radius:10px; }
.hkpin-field input{ flex:1; font-size:16px; border:none; outline:none; padding:6px 4px; }
.hkpin-icon{ border:none; background:transparent; cursor:pointer; font-size:16px; }
.hkpin-error{ color:#b91c1c; font-weight:600; font-size:12px; margin-top:8px; display:none; }
.hkpin-actions{ display:flex; gap:8px; justify-content:center; margin-top:16px; }
.btn-ok{ background:#6d5ef6; color:#fff; border:none; padding:8px 14px; border-radius:999px; font-weight:700; cursor:pointer; }
.btn-cancel{ background:#eee; color:#333; border:none; padding:8px 14px; border-radius:999px; font-weight:700; cursor:pointer; }
.btn-ok:hover{ filter:brightness(.97); } .btn-cancel:hover{ filter:brightness(.97); }

/* Inventario principal */
.invp-wrap{ max-width: 420px; margin: 0 auto; }
.invp-head{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
.invp-hist{ background:#f7f7f7; border:1px dashed #ccc; color:#666; padding:6px 8px; border-radius:8px; font-size:12px; }
.invp-row{ display:flex; align-items:center; gap:8px; margin:6px 0; }
.invp-row label{ flex: 1 1 auto; font-size:13px; }
.invp-row input, .invp-row select{ flex: 0 0 120px; padding:6px 8px; border:1px solid #ddd; border-radius:8px; font-size:14px; }
.invp-section{ margin:10px 0 6px; font-weight:800; }
.invp-box{ border:1px solid #eee; padding:8px; border-radius:10px; margin-bottom:10px; background:#fff; }
.invp-note{ color:#666; font-size:12px; margin:4px 0 0; }
.invp-actions{ display:flex; justify-content:flex-end; gap:8px; margin-top:10px; }
.invp-counter{ display:flex; align-items:center; gap:6px; }
.invp-counter button{ width:28px; height:28px; border:none; border-radius:8px; background:#eee; cursor:pointer; }
.invp-textarea{ width:100%; min-height:80px; border:1px solid #ddd; border-radius:10px; padding:8px; }
.modal-contenido h2{ margin-top:0; }
/* === FIN estilos HK === */


/* --- Prioridad m√°xima para Inventario --- */
#inventarioOverlay{ z-index: 10100 !important; }
body.hk-modal-open{ overflow: hidden; }
/* ---------------------------------------- */


/* --- Modal de √©xito Inventario --- */
.hk-success-overlay{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  background: rgba(0,0,0,.35); backdrop-filter: blur(3px);
  z-index: 10200;
}
.hk-success-overlay.activo{ display:flex; }
.hk-success-card{
  width:min(440px,92vw); background:#fff; border-radius:16px; padding:22px 22px 18px;
  box-shadow:0 30px 60px rgba(0,0,0,.28); text-align:center;
  animation: hkPop .18s ease-out;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}
.hk-success-icon{
  width:72px; height:72px; border-radius:999px; margin:4px auto 10px;
  display:grid; place-items:center; font-size:36px; color:#10b981;
  background: radial-gradient(circle at 30% 30%, #ecfdf5, #d1fae5);
  border: 1px solid #bbf7d0;
}
.hk-success-title{ font-size:18px; font-weight:800; margin:6px 0 4px; color:#111827; }
.hk-success-msg{ font-size:14px; color:#374151; margin:0 0 12px; }
.hk-success-actions{ display:flex; justify-content:center; gap:8px; margin-top:8px; }
.hk-btn-primary{
  background:#10b981; color:#fff; border:none; border-radius:999px; padding:8px 16px; font-weight:700; cursor:pointer;
  box-shadow:0 10px 20px rgba(16,185,129,.25);
}
.hk-btn-primary:hover{ filter:brightness(.97); }
@keyframes hkPop{ from{ transform:scale(.98); opacity:0 } to{ transform:scale(1); opacity:1 } }
/* --- fin √©xito --- */


/* === HK: video en primera columna de galer√≠a === */
.bloque-imagen video{
  width: 100% !important;
  height: auto !important;
  display: block;
  border-radius: 10px;
  cursor: zoom-in; /* se mantiene el hint visual */
}


/* ===== Concentrado (scoped) ===== */
#concentradoOverlay{position:fixed;inset:0;background:rgba(17,24,39,.45);backdrop-filter:blur(3px);z-index:10040;display:none;align-items:center;justify-content:center}
#concentradoOverlay.activo{display:flex}
#concentradoOverlay .modal-contenido{width:clamp(720px,96vw,1500px);max-height:90vh;background:#fff;border-radius:18px;box-shadow:0 20px 45px rgba(0,0,0,.3);overflow:hidden;display:flex;flex-direction:column}
#concentradoOverlay h2{margin:0;padding:14px 18px;font-size:18px;text-align:center;background:linear-gradient(135deg,#0ea5e9,#6366f1);color:#fff;letter-spacing:.3px}
#concentradoOverlay .conc-toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 14px;background:#fafafa;border-bottom:1px solid #e5e7eb;flex-wrap:wrap}
#concentradoOverlay .conc-toolbar .left{display:flex;gap:10px;align-items:center;flex:1 1 auto;min-width:280px}
#concentradoOverlay .conc-toolbar input[type="search"]{padding:8px 10px;border:1px solid #d1d5db;border-radius:12px;min-width:260px;max-width:420px;width:100%}
#concentradoOverlay .conc-stats{font-size:12px;color:#374151;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:45vw}
#concentradoOverlay .table-wrap{padding:0 14px 12px 14px;overflow:auto;max-height:100%}
#concentradoOverlay .conc-table{width:100%;border-collapse:separate;border-spacing:0}
#concentradoOverlay .conc-table thead th{position:sticky;top:0;z-index:1;background:#f8fafc;border-bottom:1px solid #e5e7eb;cursor:pointer;user-select:none}
#concentradoOverlay .conc-table th,#concentradoOverlay .conc-table td{padding:8px 10px;border-right:1px solid #eef2f7;border-bottom:1px solid #eef2f7;font-size:12px;white-space:nowrap;max-width:320px;overflow:hidden;text-overflow:ellipsis}
#concentradoOverlay .conc-table tr:nth-child(even) td{background:#fcfdff}
#concentradoOverlay .conc-table tr:hover td{background:#f1f5ff}
#concentradoOverlay .conc-actions{padding:10px 14px;border-top:1px solid #e5e7eb;background:#fafafa;display:flex;gap:.5rem;justify-content:flex-end}
#concentradoOverlay .btn{border:none;padding:8px 12px;border-radius:10px;cursor:pointer}
#concentradoOverlay .btn.ok{background:#10b981;color:#fff}
#concentradoOverlay .btn.primary{background:#3b82f6;color:#fff}
#concentradoOverlay .btn.danger{background:#ef4444;color:#fff}
#concentradoOverlay .spinner{width:16px;height:16px;border:2px solid #fff;border-top-color:transparent;border-radius:50%;display:inline-block;animation:concspin 0.8s linear infinite;margin-left:6px}
@keyframes concspin{to{transform:rotate(360deg)}}
#hk-badge{position:fixed;top:10px;right:10px;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;z-index:10060;background:#ef4444;color:#fff;box-shadow:0 4px 10px rgba(0,0,0,.15)}
#hk-badge.ok{background:#10b981}


/* === INV-Scroll minimal (solo est√©tica modal inventario) === */
#inventarioOverlay{ align-items:flex-start; overflow:auto; overscroll-behavior:contain; padding:16px 8px; }
#inventarioOverlay .modal-contenido{ width:clamp(720px,96vw,1200px); max-height:calc(100vh - 32px); overflow:auto; -webkit-overflow-scrolling:touch; touch-action:pan-y; }
#inventarioOverlay .invp-actions{ position:sticky; bottom:0; background:#fff; padding-top:8px; z-index:1; }
@media (max-height:700px){ #inventarioOverlay .modal-contenido{ max-height:calc(100vh - 16px); } }

/* === CONC-FS-002: Pantalla completa robusta === */
#concentradoOverlay.fullscreen{ z-index: 9999; }
#concentradoOverlay.fullscreen .modal-contenido{
  width: 98vw !important;
  max-width: none !important;
  max-height: 94vh !important;
  height: 94vh !important;
}
#concentradoOverlay.fullscreen .table-wrap{ height: calc(94vh - 120px) !important; }
body.hk-no-scroll{ overflow: hidden !important; }

/* === CONC-TOOLBAR-FIX: centrar y evitar desbordes === */
#concentradoOverlay .conc-toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
#concentradoOverlay .conc-toolbar .right{display:flex;flex-wrap:wrap;gap:8px;justify-content:flex-end;margin-left:auto;}
#concentradoOverlay .conc-toolbar .right .btn{white-space:nowrap;}
#concentradoOverlay .conc-toolbar .btn{padding:6px 10px;border-radius:10px;font-weight:700;font-size:13px;}
@media (max-width:1100px){
  #concentradoOverlay .conc-toolbar{flex-direction:column;align-items:stretch;}
  #concentradoOverlay .conc-toolbar .right{justify-content:center;width:100%;}
}
#concentradoOverlay .conc-toolbar .right #conc-cerrar{order:99;}


/* === CONC-PURGE-MODAL: modal de depuraci√≥n (UI) === */
.hk-purge-mask{
  position:fixed; inset:0; background:rgba(0,0,0,.45);
  display:flex; align-items:center; justify-content:center;
  z-index: 10000;
}
.hk-purge-dialog{
  width:min(560px, 96vw); background:#fff; border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.2); padding:18px 18px 14px;
  font-family:inherit;
}
.hk-purge-dialog h3{ margin:0 0 6px; font-size:18px; font-weight:800; color:#111827; }
.hk-purge-dialog p.desc{ margin:0 0 10px; color:#374151; font-size:14px; }
.hk-purge-dialog .warn{ background:#FEF3C7; color:#92400E; padding:8px 10px; border-radius:10px; font-size:13px; margin-bottom:10px; }
.hk-purge-dialog .row{ display:flex; gap:10px; margin:8px 0; }
.hk-purge-dialog label{ font-size:12px; font-weight:700; color:#374151; display:block; margin-bottom:4px; }
.hk-purge-dialog input[type="text"], .hk-purge-dialog input[type="password"]{
  width:100%; border:1px solid #cbd5e1; border-radius:10px; padding:8px 10px; font-size:14px;
}
.hk-purge-dialog .confirm{ display:flex; gap:8px; align-items:center; font-size:13px; margin:6px 0 10px; }
.hk-purge-dialog .error{ color:#b91c1c; font-size:12px; min-height:16px; }
.hk-purge-dialog .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:8px; }
.hk-purge-dialog button{
  border:none; border-radius:10px; padding:8px 12px; font-weight:800; cursor:pointer;
}
.hk-purge-dialog .btn-cancel{ background:#e5e7eb; color:#111827; }
.hk-purge-dialog .btn-go{ background:#ef4444; color:#fff; }
.hk-purge-dialog .btn-go[disabled]{ opacity:.6; cursor:not-allowed; }

</style>

<style>
.modal-contenido video {
    position: absolute;
    top: 10px;
    right: 10px;
    transform: scale(0.85); /* escala ajustable */
    transform-origin: top right;
    transition: transform 0.3s ease;
    cursor: zoom-in;
    max-width: 90%;
    max-height: 90%;
    border-radius: 8px;
}
.modal-contenido video.zoomed {
    transform: scale(1.6); /* zoom al hacer clic */
    cursor: zoom-out;
}
</style>

</head>
<body>
  <!-- Modal de √âxito Inventario -->
  <div id="hkSuccessModal" class="hk-success-overlay" aria-hidden="true">
    <div class="hk-success-card" role="dialog" aria-modal="true" aria-labelledby="hk-success-title">
      <div class="hk-success-icon">‚úî</div>
      <h3 id="hk-success-title" class="hk-success-title">¬°Inventario guardado!</h3>
      <p id="hk-success-msg" class="hk-success-msg">Tu registro se guard√≥ correctamente.</p>
      <div class="hk-success-actions">
        <button id="hk-success-ok" class="hk-btn-primary">Listo</button>
      </div>
    </div>
  </div>

  <!-- Acceso Housekeeping Modal -->
  <div id="hkpin2" class="hkpin-overlay" aria-hidden="true">
    <div class="hkpin-modal" role="dialog" aria-modal="true" aria-labelledby="hkpin2-title">
      <h3 id="hkpin2-title">Acceso Housekeeping</h3>
      <p class="hkpin-sub">Ingresa tu matr√≠cula para abrir el inventario.</p>
      <div class="hkpin-field">
        <input id="hkpin2-input" type="password" inputmode="numeric" pattern="[0-9]*" placeholder="Matr√≠cula" autocomplete="one-time-code" />
        <button id="hkpin2-toggle" type="button" class="hkpin-icon" aria-label="Mostrar/Ocultar PIN">üëÅÔ∏è</button>
        <button id="hkpin2-clear" type="button" class="hkpin-icon" aria-label="Borrar">‚¶ø</button>
      </div>
      <div id="hkpin2-error" class="hkpin-error">Matr√≠cula inv√°lida</div>
      <div class="hkpin-actions">
        <button id="hkpin2-cancel" class="btn-cancel">Cancelar</button>
        <button id="hkpin2-ok" class="btn-ok">Ingresar</button>
      </div>
    </div>
  </div>

  <button id="btn-logout" class="btn-logout" onclick="hkLogout()" style="display:none">Cerrar sesi√≥n</button>
<a id="btn-concentrado" class="btn-reporte" style="display:none" href="javascript:void(0)">üìä Concentrado</a>
<span id="hk-badge" style="display:none"></span>


  <h1 class="titulo-catalogo">
  <span>Paradisus ¬∑ Colecci√≥n Exclusiva de Habitaciones & Suites</span>
  <img loading="lazy" src="https://res.cloudinary.com/dor6za85u/image/upload/v1754887647/ChatGPT_Image_10_ago_2025_09_47_11_p.m._btrjfp.png" 
       alt="Paradisus by Meli√°" 
       class="logo-catalogo">
</h1>



  <div class="habitacion-info-panel" id="panelHabitacion">
  <div class="habitacion-detalle" id="contenidoHabitacion">
    <!-- Aqu√≠ se insertar√° el contenido din√°mico -->
  </div>

<!-- Panel de filtro por categor√≠a -->
<div class="panel-filtro-categoria">
  <label for="filtro-categoria">Categor√≠a:</label>
  <select id="filtro-categoria">
    <option value="">Todas</option>
  </select>

  
  <label for="filtro-cama">Cama:</label>
  <select id="filtro-cama">
    <option value="">Todas</option>
    <option value="K">K</option>
    <option value="D">D</option>
  </select>

  <label for="filtro-prefijo">Recepci√≥n:</label>
  <select id="filtro-prefijo" title="Recepci√≥n">
    <option value="">Todas</option>
    <option value="C">PLC - Paradisus</option>
    <option value="S">THR - The Reserve</option>
  </select>

  <label class="chk"><input type="checkbox" id="filtro-handicap"> Handicap ‚ôø</label>
  <label class="chk"><input type="checkbox" id="filtro-cocineta"> Cocineta</label>

  <span id="totales-resumen" class="contador-categoria">
    K: 0 ¬∑ D: 0 ¬∑ Total: 0 ‚Äî Reserve: 0 ¬∑ ‚ôø: 0 ¬∑ Cocineta: 0
  </span>
  <a id="btn-descargar-pdf" href="introduccion_paradisus_2025.pdf" download class="btn-reporte" title="Descargar reporte PDF" target="_blank">üìÑ Descargar PDF</a>

<button id="btn-limpiar-filtro" type="button">Limpiar</button>

  <span class="contador-categoria">
    Coincidencias: <strong id="total-coincidencias-categoria">0</strong>
  </span>
</div>
<div id="totales-tabla" class="totales-tabla" style="padding: 10px 16px;"></div>


  <div class="zona-desplazable">

    <!-- Torre 1 -->
    <div class="torre">
      <h2>Torre 1</h2>
      <div class="piso">
<button class="habitacion-btn" data-num="1501">1501</button>
<button class="habitacion-btn" data-num="1502">1502</button>
<button class="habitacion-btn" data-num="1503">1503</button>
<button class="habitacion-btn" data-num="1504">1504</button>
<button class="habitacion-btn" data-num="1505">1505</button>
<button class="habitacion-btn" data-num="1506">1506</button>
<button class="habitacion-btn" data-num="1507">1507</button>
<button class="habitacion-btn" data-num="1508">1508</button>
<button class="habitacion-btn" data-num="1509">1509</button>
<button class="habitacion-btn" data-num="1510">1510</button>

      </div>

      <div class="pasillo"></div>

      <div class="piso">
<button class="habitacion-btn" data-num="1522">1522</button>
<button class="habitacion-btn" data-num="1521">1521</button>
<button class="habitacion-btn" data-num="1520">1520</button>
<button class="habitacion-btn" data-num="1519">1519</button>
<button class="habitacion-btn" data-num="1518">1518</button>
<button class="habitacion-btn" data-num="1517">1517</button>
<button class="habitacion-btn" data-num="1516">1516</button>
<button class="habitacion-btn" data-num="1515">1515</button>
<button class="habitacion-btn" data-num="1514">1514</button>
<button class="habitacion-btn" data-num="1512">1512</button>
<button class="habitacion-btn" data-num="1511">1511</button>

      </div>

      <div class="pasillo"></div>

      <div class="piso">
<button class="habitacion-btn" data-num="1401">1401</button>
<button class="habitacion-btn" data-num="1402">1402</button>
<button class="habitacion-btn" data-num="1403">1403</button>
<button class="habitacion-btn" data-num="1404">1404</button>
<button class="habitacion-btn" data-num="1405">1405</button>
<button class="habitacion-btn" data-num="1406">1406</button>
<button class="habitacion-btn" data-num="1407">1407</button>
<button class="habitacion-btn" data-num="1408">1408</button>
<button class="habitacion-btn" data-num="1409">1409</button>
<button class="habitacion-btn" data-num="1410">1410</button>

      </div>

      <div class="pasillo"></div>

      <div class="piso">
<button class="habitacion-btn" data-num="1422">1422</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="1421">1421</button>
<button class="habitacion-btn" data-num="1420">1420</button>
<button class="habitacion-btn" data-num="1419">1419</button>
<button class="habitacion-btn" data-num="1418">1418</button>
<button class="habitacion-btn" data-num="1417">1417</button>
<button class="habitacion-btn" data-num="1416">1416</button>
<button class="habitacion-btn" data-num="1415">1415</button>
<button class="habitacion-btn" data-num="1414">1414</button>
<button class="habitacion-btn" data-num="1412">1412</button>
<button class="habitacion-btn" data-num="1411">1411</button>

      </div>

      <div class="pasillo"></div>

      <div class="piso">
<button class="habitacion-btn" data-num="1301">1301</button>
<button class="habitacion-btn" data-num="1302">1302</button>
<button class="habitacion-btn" data-num="1303">1303</button>
<button class="habitacion-btn" data-num="1304">1304</button>
<button class="habitacion-btn" data-num="1305">1305</button>
<button class="habitacion-btn" data-num="1306">1306</button>
<button class="habitacion-btn" data-num="1307">1307</button>
<button class="habitacion-btn" data-num="1308">1308</button>
<button class="habitacion-btn" data-num="1309">1309</button>
<button class="habitacion-btn" data-num="1310">1310</button>

      </div>

      <div class="pasillo"></div>

      <div class="piso">
<button class="habitacion-btn" data-num="1322">1322</button>
<button class="habitacion-btn" data-num="1321">1321</button>
<button class="habitacion-btn" data-num="1320">1320</button>
<button class="habitacion-btn" data-num="1319">1319</button>
<button class="habitacion-btn" data-num="1318">1318</button>
<button class="habitacion-btn" data-num="1317">1317</button>
<button class="habitacion-btn" data-num="1316">1316</button>
<button class="habitacion-btn" data-num="1315">1315</button>
<button class="habitacion-btn" data-num="1314">1314</button>
<button class="habitacion-btn" data-num="1312">1312</button>
<button class="habitacion-btn" data-num="1311">1311</button>

      </div>

      <div class="pasillo"></div>

      <!-- Piso 12 (solo externas) -->
<div class="fila-base jardin-ficticio">
    üåµ JARD√çN DE CACTUS ‚Äî ESPEJO DE AGUA üåä
</div>

      <div class="pasillo"></div>

      <div class="piso">
<button class="habitacion-btn" data-num="1222">1222</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="1221">1221</button>
<button class="habitacion-btn" data-num="1220">1220</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="1219">1219</button>
<button class="habitacion-btn" data-num="1218">1218</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="1217">1217</button>
<button class="habitacion-btn" data-num="1216">1216</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="1215">1215</button>
<button class="habitacion-btn" data-num="1214">1214</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="1212">1212</button>
<button class="habitacion-btn" data-num="1211">1211</button>

      </div>
    </div>

<!-- Torre 2 -->
<div class="torre torre-2">
  <h2>Torre 2</h2>
  <!-- Piso 4 - Vista Interna -->
  <div class="piso">
<button class="habitacion-btn" data-num="2401">2401</button>
<button class="habitacion-btn" data-num="2402">2402</button>
<button class="habitacion-btn" data-num="2403">2403</button>
<button class="habitacion-btn" data-num="2404">2404</button>
<button class="habitacion-btn" data-num="2405">2405</button>
<button class="habitacion-btn" data-num="2406">2406</button>
<button class="habitacion-btn" data-num="2407">2407</button>
<button class="habitacion-btn" data-num="2408">2408</button>

    </div>

    <div class="pasillo"></div>

    <!-- Piso 4 - Vista Externa -->
     <div class="piso">
<button class="habitacion-btn" data-num="2418">2418</button>
<button class="habitacion-btn" data-num="2417">2417</button>
<button class="habitacion-btn" data-num="2416">2416</button>
<button class="habitacion-btn" data-num="2415">2415</button>
<button class="habitacion-btn" data-num="2414">2414</button>
<button class="habitacion-btn" data-num="2412">2412</button>
<button class="habitacion-btn" data-num="2411">2411</button>
<button class="habitacion-btn" data-num="2410">2410</button>
<button class="habitacion-btn" data-num="2409">2409</button>

  </div>

  <div class="pasillo"></div>

  <!-- Piso 2 - Vista Interna -->
  <div class="piso">
<button class="habitacion-btn" data-num="2301">2301</button>
<button class="habitacion-btn" data-num="2302">2302</button>
<button class="habitacion-btn" data-num="2303">2303</button>
<button class="habitacion-btn" data-num="2304">2304</button>
<button class="habitacion-btn" data-num="2305">2305</button>
<button class="habitacion-btn" data-num="2306">2306</button>
<button class="habitacion-btn" data-num="2307">2307</button>
<button class="habitacion-btn" data-num="2308">2308</button>

    </div>

  <div class="pasillo"></div>

  <!-- Piso 3 - Vista Externa -->
  <div class="piso">
<button class="habitacion-btn" data-num="2318">2318</button>
<button class="habitacion-btn" data-num="2317">2317</button>
<button class="habitacion-btn" data-num="2316">2316</button>
<button class="habitacion-btn" data-num="2315">2315</button>
<button class="habitacion-btn" data-num="2314">2314</button>
<button class="habitacion-btn" data-num="2312">2312</button>
<button class="habitacion-btn" data-num="2311">2311</button>
<button class="habitacion-btn" data-num="2310">2310</button>
<button class="habitacion-btn" data-num="2309">2309</button>

  </div>

  <div class="pasillo"></div>

  <!-- Piso 2 - Vista Interna -->
  <div class="piso">
<button class="habitacion-btn" data-num="2201">2201</button>
<button class="habitacion-btn" data-num="2202">2202</button>
<button class="habitacion-btn" data-num="2203">2203</button>
<button class="habitacion-btn" data-num="2204">2204</button>
<button class="habitacion-btn" data-num="2205">2205</button>
<button class="habitacion-btn" data-num="2206">2206</button>
<button class="habitacion-btn" data-num="2207">2207</button>
<button class="habitacion-btn" data-num="2208">2208</button>

    </div>

    <div class="pasillo"></div>

    <!-- Piso 2 - Vista Externa -->
     <div class="piso">
<button class="habitacion-btn" data-num="2218">2218</button>
<button class="habitacion-btn" data-num="2217">2217</button>
<button class="habitacion-btn" data-num="2216">2216</button>
<button class="habitacion-btn" data-num="2215">2215</button>
<button class="habitacion-btn" data-num="2214">2214</button>
<button class="habitacion-btn" data-num="2212">2212</button>
<button class="habitacion-btn" data-num="2211">2211</button>
<button class="habitacion-btn" data-num="2210">2210</button>
<button class="habitacion-btn" data-num="2209">2209</button>

  </div>

    <div class="pasillo"></div>

  <div class="fila-base jardin-ficticio">
    üåµ JARD√çN DE CACTUS ‚Äî ESPEJO DE AGUA üåä
</div>

  <div class="pasillo"></div>

  <!-- Piso 1 - Vista Externa -->
  <div class="piso">
<button class="habitacion-btn" data-num="2118">2118</button>
<button class="habitacion-btn" data-num="2117">2117</button>
<button class="habitacion-btn" data-num="2116">2116</button>
<button class="habitacion-btn" data-num="2115">2115</button>
<button class="habitacion-btn" data-num="2114">2114</button>
<button class="habitacion-btn" data-num="2112">2112</button>
<button class="habitacion-btn" data-num="2111">2111</button>
<button class="habitacion-btn" data-num="2110">2110</button>
<button class="habitacion-btn" data-num="2109">2109</button>

  </div>
</div>

    <!-- Torre 3 -->
    <div class="torre torre-3">
      <h2>Torre 3</h2>
      <div class="piso">
<button class="habitacion-btn" data-num="3301">3301</button>
<button class="habitacion-btn" data-num="3302">3302</button>
<button class="habitacion-btn" data-num="3303">3303</button>
<button class="habitacion-btn" data-num="3304">3304</button>
<button class="habitacion-btn" data-num="3305">3305</button>
<button class="habitacion-btn" data-num="3306">3306</button>
<button class="habitacion-btn" data-num="3307">3307</button>
<button class="habitacion-btn" data-num="3308">3308</button>
<button class="habitacion-btn" data-num="3309">3309</button>
<button class="habitacion-btn" data-num="3310">3310</button>
<button class="habitacion-btn" data-num="3311">3311</button>
<button class="habitacion-btn" data-num="3312">3312</button>

      </div>

       <div class="pasillo"></div>

<div class="fila-base">
<button class="habitacion-btn" data-num="3330">3330</button>
<button class="habitacion-btn" data-num="3329">3329</button>
<button class="habitacion-btn" data-num="3328">3328</button>
<button class="habitacion-btn" data-num="3327">3327</button>
<button class="habitacion-btn" data-num="3326">3326</button>
<button class="habitacion-btn" data-num="3325">3325</button>
<button class="habitacion-btn" data-num="3324">3324</button>
<button class="habitacion-btn" data-num="3323">3323</button>
<button class="habitacion-btn" data-num="3322">3322</button>
<button class="habitacion-btn" data-num="3321">3321</button>
<button class="habitacion-btn" data-num="3320">3320</button>

</div>

          <div class="pasillo"></div>

<div class="fila-base">
<button class="habitacion-btn" data-num="3201">3201</button>
<button class="habitacion-btn" data-num="3202">3202</button>
<button class="habitacion-btn" data-num="3203">3203</button>
<button class="habitacion-btn" data-num="3204">3204</button>
<button class="habitacion-btn" data-num="3205">3205</button>
<button class="habitacion-btn" data-num="3206">3206</button>
<button class="habitacion-btn" data-num="3207">3207</button>
<button class="habitacion-btn" data-num="3208">3208</button>
<button class="habitacion-btn" data-num="3209">3209</button>
<button class="habitacion-btn" data-num="3210">3210</button>
<button class="habitacion-btn" data-num="3211">3211</button>
<button class="habitacion-btn" data-num="3212">3212</button>

  </div>

<div class="fila-base">
<button class="habitacion-btn" data-num="3214">3214</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="3215">3215</button>
<button class="habitacion-btn" data-num="3216">3216</button>
<button class="habitacion-btn" data-num="3217">3217</button>
<button class="habitacion-btn" data-num="3218">3218</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->

    </div>

<div class="fila-base">
<button class="habitacion-btn" data-num="3230">3230</button>
<button class="habitacion-btn" data-num="3229">3229</button>
<button class="habitacion-btn" data-num="3228">3228</button>
<button class="habitacion-btn" data-num="3227">3227</button>
<button class="habitacion-btn" data-num="3226">3226</button>
<button class="habitacion-btn" data-num="3225">3225</button>
<button class="habitacion-btn" data-num="3224">3224</button>
<button class="habitacion-btn" data-num="3223">3223</button>
<button class="habitacion-btn" data-num="3222">3222</button>
<button class="habitacion-btn" data-num="3221">3221</button>
<button class="habitacion-btn" data-num="3220">3220</button>
<button class="habitacion-btn" data-num="3219">3219</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->

    </div>

   <div class="pasillo"></div>

      <div class="fila-base">
<button class="habitacion-btn" data-num="3101">3101</button>
<button class="habitacion-btn" data-num="3102">3102</button>
<button class="habitacion-btn" data-num="3103">3103</button>
<button class="habitacion-btn" data-num="3104">3104</button>
<button class="habitacion-btn" data-num="3105">3105</button>
<button class="habitacion-btn" data-num="3106">3106</button>
<button class="habitacion-btn" data-num="3107">3107</button>
<button class="habitacion-btn" data-num="3108">3108</button>
<button class="habitacion-btn" data-num="3109">3109</button>
<button class="habitacion-btn" data-num="3110">3110</button>
<button class="habitacion-btn" data-num="3111">3111</button>
<button class="habitacion-btn" data-num="3112">3112</button>

</div>

      <div class="columna-derecha">
<button class="habitacion-btn" data-num="3114">3114</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="3115">3115</button>
<button class="habitacion-btn" data-num="3116">3116</button>
<button class="habitacion-btn" data-num="3117">3117</button>
<button class="habitacion-btn" data-num="3118">3118</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->

</div>

      <div class="fila-base">
<button class="habitacion-btn" data-num="3130">3130</button>
<button class="habitacion-btn" data-num="3129">3129</button>
<button class="habitacion-btn" data-num="3128">3128</button>
<button class="habitacion-btn" data-num="3127">3127</button>
<button class="habitacion-btn" data-num="3126">3126</button>
<button class="habitacion-btn" data-num="3125">3125</button>
<button class="habitacion-btn" data-num="3124">3124</button>
<button class="habitacion-btn" data-num="3123">3123</button>
<button class="habitacion-btn" data-num="3122">3122</button>
<button class="habitacion-btn" data-num="3121">3121</button>
<button class="habitacion-btn" data-num="3120">3120</button>
<button class="habitacion-btn" data-num="3119">3119</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->

</div>



       <div class="pasillo"></div>

<div class="columna-derecha">
<button class="habitacion-btn" data-num="3014">3014</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="3015">3015</button>
<button class="habitacion-btn" data-num="3016">3016</button>
<button class="habitacion-btn" data-num="3017">3017</button>
<button class="habitacion-btn" data-num="3018">3018</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->

</div>
<div class="pasillo"></div>
            <div class="fila-base jardin-ficticio">
    üåµ JARD√çN DE CACTUS üåµ
              </div>
<div class="pasillo"></div>        
      <div class="fila-base">
<button class="habitacion-btn" data-num="3030">3030</button>
<button class="habitacion-btn" data-num="3029">3029</button>
<button class="habitacion-btn" data-num="3028">3028</button>
<button class="habitacion-btn" data-num="3027">3027</button>
<button class="habitacion-btn" data-num="3026">3026</button>
<button class="habitacion-btn" data-num="3025">3025</button>
<button class="habitacion-btn" data-num="3024">3024</button>
<button class="habitacion-btn" data-num="3023">3023</button>
<button class="habitacion-btn" data-num="3022">3022</button>
<button class="habitacion-btn" data-num="3021">3021</button>
<button class="habitacion-btn" data-num="3020">3020</button>
<button class="habitacion-btn" data-num="3019">3019</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->

</div>

    </div>

    <!-- Torre 4 -->
<div class="torre torre-4">
      <h2>Torre 4</h2>
      <div class="piso">
<button class="habitacion-btn" data-num="4529">4529</button>
<button class="habitacion-btn" data-num="4528">4528</button>
<button class="habitacion-btn" data-num="4527">4527</button>
<button class="habitacion-btn" data-num="4526">4526</button>
<button class="habitacion-btn" data-num="4525">4525</button>
<button class="habitacion-btn" data-num="4524">4524</button>
<button class="habitacion-btn" data-num="4523">4523</button>
<button class="habitacion-btn" data-num="4522">4522</button>
<button class="habitacion-btn" data-num="4521">4521</button>
        <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4520">4520</button>
<button class="habitacion-btn" data-num="4519">4519</button>
<button class="habitacion-btn" data-num="4518">4518</button>

</div>

  <div class="fila-base">
<button class="habitacion-btn" data-num="4517">4517</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4516">4516</button>
<button class="habitacion-btn" data-num="4515">4515</button>
<button class="habitacion-btn" data-num="4514">4514</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4512">4512</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4511">4511</button>

</div>

  <div class="fila-base">
<button class="habitacion-btn" data-num="4501">4501</button>
<button class="habitacion-btn" data-num="4502">4502</button>
<button class="habitacion-btn" data-num="4503">4503</button>
<button class="habitacion-btn" data-num="4504">4504</button>
<button class="habitacion-btn" data-num="4505">4505</button>
<button class="habitacion-btn" data-num="4506">4506</button>
<button class="habitacion-btn" data-num="4507">4507</button>
<button class="habitacion-btn" data-num="4508">4508</button>
<button class="habitacion-btn" data-num="4509">4509</button>
<button class="habitacion-btn" data-num="4510">4510</button>

</div>

  <div class="pasillo"></div>

  <div class="fila-base">
<button class="habitacion-btn" data-num="4429">4429</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4428">4428</button>
<button class="habitacion-btn" data-num="4427">4427</button>
<button class="habitacion-btn" data-num="4426">4426</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4425">4425</button>
<button class="habitacion-btn" data-num="4424">4424</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4423">4423</button>
<button class="habitacion-btn" data-num="4422">4422</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4421">4421</button>
<button class="habitacion-btn" data-num="4420">4420</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4419">4419</button>
<button class="habitacion-btn" data-num="4418">4418</button>

</div>

  <div class="fila-base">
<button class="habitacion-btn" data-num="4417">4417</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4416">4416</button>
<button class="habitacion-btn" data-num="4415">4415</button>
<button class="habitacion-btn" data-num="4414">4414</button>
<button class="habitacion-btn" data-num="4412">4412</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4411">4411</button>

</div>

  <div class="fila-base">
<button class="habitacion-btn" data-num="4401">4401</button>
<button class="habitacion-btn" data-num="4402">4402</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4403">4403</button>
<button class="habitacion-btn" data-num="4404">4404</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4405">4405</button>
<button class="habitacion-btn" data-num="4406">4406</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4407">4407</button>
<button class="habitacion-btn" data-num="4408">4408</button>
<button class="habitacion-btn" data-num="4409">4409</button>
<button class="habitacion-btn" data-num="4410">4410</button>

</div> 

<div class="pasillo"></div>

<div class="fila-base">
<button class="habitacion-btn" data-num="4329">4329</button>
<button class="habitacion-btn" data-num="4328">4328</button>
<button class="habitacion-btn" data-num="4327">4327</button>
<button class="habitacion-btn" data-num="4326">4326</button>
<button class="habitacion-btn" data-num="4325">4325</button>
   <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4324">4324</button>
<button class="habitacion-btn" data-num="4323">4323</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4322">4322</button>
<button class="habitacion-btn" data-num="4321">4321</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4320">4320</button>
<button class="habitacion-btn" data-num="4319">4319</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4318">4318</button>

</div>

<div class="fila-base">
<button class="habitacion-btn" data-num="4317">4317</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4316">4316</button>
<button class="habitacion-btn" data-num="4315">4315</button>
<button class="habitacion-btn" data-num="4314">4314</button>
<button class="habitacion-btn" data-num="4312">4312</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4311">4311</button>
</div>


<div class="fila-base">
<button class="habitacion-btn" data-num="4301">4301</button>
<button class="habitacion-btn" data-num="4302">4302</button>
<button class="habitacion-btn" data-num="4303">4303</button>
<button class="habitacion-btn" data-num="4304">4304</button>
<button class="habitacion-btn" data-num="4305">4305</button>
<button class="habitacion-btn" data-num="4306">4306</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4307">4307</button>
<button class="habitacion-btn" data-num="4308">4308</button>
<button class="habitacion-btn" data-num="4309">4309</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4310">4310</button>

</div>

<div class="pasillo"></div>


<div class="fila-base">
<button class="habitacion-btn" data-num="4229">4229</button>
<button class="habitacion-btn" data-num="4228">4228</button>
<button class="habitacion-btn" data-num="4227">4227</button>
<button class="habitacion-btn" data-num="4226">4226</button>
<button class="habitacion-btn" data-num="4225">4225</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4224">4224</button>
<button class="habitacion-btn" data-num="4223">4223</button>
<button class="habitacion-btn" data-num="4222">4222</button>
<button class="habitacion-btn" data-num="4221">4221</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4220">4220</button>
<button class="habitacion-btn" data-num="4219">4219</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4218">4218</button>

</div>

<div class="fila-base">
<button class="habitacion-btn" data-num="4217">4217</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4216">4216</button>
<button class="habitacion-btn" data-num="4215">4215</button>
<button class="habitacion-btn" data-num="4214">4214</button>
<button class="habitacion-btn" data-num="4212">4212</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4211">4211</button>

</div>

<div class="fila-base">
<button class="habitacion-btn" data-num="4201">4201</button>
<button class="habitacion-btn" data-num="4202">4202</button>
<button class="habitacion-btn" data-num="4203">4203</button>
<button class="habitacion-btn" data-num="4204">4204</button>
<button class="habitacion-btn" data-num="4205">4205</button>
<button class="habitacion-btn" data-num="4206">4206</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4207">4207</button>
<button class="habitacion-btn" data-num="4208">4208</button>
<button class="habitacion-btn" data-num="4209">4209</button>
  <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4210">4210</button>

</div>

<div class="pasillo"></div>
              <div class="fila-base jardin-ficticio">
    üåµ EDIFICIO / PASILLO üåµ
              </div>
  <div class="pasillo"></div>

  <div class="fila-base">
<button class="habitacion-btn" data-num="4117">4117</button>
<button class="habitacion-btn" data-num="4116">4116</button>
<button class="habitacion-btn" data-num="4115">4115</button>
<button class="habitacion-btn" data-num="4114">4114</button>
<button class="habitacion-btn" data-num="4112">4112</button>
    <div class="conector-conectadas">‚áÑ</div>  <!-- Flecha de doble punta -->
<button class="habitacion-btn" data-num="4111">4111</button>
  </div>
</div>


  <!-- Panel flotante inferior -->
  <div id="panelInferior" class="panel-inferior">
    <div id="mensajeSeleccion" class="mensaje-inicial">
  ‚ÑπÔ∏è Selecciona una habitaci√≥n para ver m√°s detalles.
</div>
</div>

  <!-- Lightbox de imagen -->
<div id="zoom-overlay" class="visor-oculto" onclick="cerrarZoom(event)">
  <span id="zoom-close" onclick="cerrarZoom(event)" style="position: absolute; top: 20px; right: 30px; font-size: 30px; cursor: pointer; color: white;">‚ùå</span>
  <img loading="lazy" id="zoom-img" src="" alt="Zoom" />
</div>

  <script>

async function mostrarInfo(num) {
  const panel = document.getElementById("panelInferior");
  const mensaje = document.getElementById("mensajeSeleccion");
  if (mensaje) mensaje.style.display = "none";

  try {
    const response = await fetch("habitaciones.json");
    const data = await response.json();

    if (data[num]) {
      const habitacion = data[num];

      let galeriaHTML = '<div class="galeria-habitacion">';
      habitacion.imagenes.forEach((imagen) => {
        galeriaHTML += `
          <div class="bloque-imagen">
            <img loading="lazy" src="${imagen.src}" alt="${imagen.etiqueta}" onclick="hacerZoom(this.src)" />
            <p><strong>${imagen.etiqueta}</strong></p>
          </div>
        `;
      });
      galeriaHTML += '</div>';

panel.innerHTML = `
  <div class="contenido-inferior">\n<aside id="video-habitacion" class="video-habitacion" hidden>\n  <div class="video-ratio">\n    <iframe id="video-embed" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen hidden></iframe>\n    <video id="video-mp4" controls playsinline hidden></video>\n  </div>\n</aside>\n
    <h3>${habitacion.titulo}</h3>
    <button class="btn-inventario" onclick="(hkHasSession()? abrirInventarioPrincipal(${num}) : hkLogin(()=>abrirInventarioPrincipal(${num})))">üìã Inventario</button>

    <p><strong>Categor√≠a:</strong> ${habitacion.categoria} ¬∑ ${habitacion.vista}</p>
    <p><strong>Habitaci√≥n conectada:</strong> ${habitacion.habitacion_conectada ? habitacion.habitacion_conectada : 'No aplica'}</p>
    <p><strong>Piso:</strong> ${habitacion.piso}</p>
    <p><strong>Capacidad:</strong> ${habitacion.capacidad} ¬∑ ${habitacion.fumadores ? '' : 'No fumadores'}</p>
    <p><strong>Tipo de cama:</strong> ${habitacion.tipo_cama}</p>
    <p><strong>Sof√° cama:</strong> ${habitacion.sofa ? 'Incluido' : 'No disponible'}</p>
    <p><strong>Accesibilidad:</strong> ${habitacion.discapacidad ? 'Adaptada' : 'No adaptada'}</p>
    <p><strong>Caracter√≠sticas:</strong> ${habitacion.caracteristicas.join(', ')}</p>
    ${galeriaHTML}
    <button class="btn-volver" onclick="cerrarPanelInferior()">Cerrar</button>
  </div>
`;
    
    
    // === Sustituir imagen izquierda por VIDEO (si hay fuente) ===
    try{
      const gal = panel.querySelector('.galeria-habitacion');
      if(gal){
        // Resolver URL del video
        const esHandicap = !!(habitacion && (
          habitacion.discapacidad === true ||
          habitacion.handicap === true ||
          habitacion.discapacidad === 'Adaptada' ||
          habitacion.discapacidad === 'S√≠' ||
          (habitacion.categoria && /handicap|adaptad/i.test(habitacion.categoria)) ||
          (Array.isArray(habitacion.tags) && habitacion.tags.some(t=>/handicap/i.test(t)))
        ));

        let vsrc = '';
        if(esHandicap && typeof window !== 'undefined' && typeof window.HANDICAP_VIDEO_URL !== 'undefined'){
          vsrc = window.HANDICAP_VIDEO_URL || '';
        }else{
          vsrc = (habitacion && (habitacion.video || habitacion.video_url)) || '';
          if(!vsrc && typeof window !== 'undefined' && window.VIDEOS_HAB && typeof num !== 'undefined'){
            vsrc = window.VIDEOS_HAB[num] || '';
          }
        }

        if(vsrc){
          // Crear tile <div class="bloque-imagen"> con <video>
          const tile = document.createElement('div');
          tile.className = 'bloque-imagen';
          const vid = document.createElement('video');
          vid.setAttribute('muted',''); vid.muted = true;
          vid.setAttribute('playsinline',''); vid.playsInline = true;
          vid.setAttribute('autoplay',''); vid.autoplay = true;
          vid.setAttribute('loop',''); vid.loop = true;
          const src = document.createElement('source'); src.src = vsrc; src.type='video/mp4';
          vid.appendChild(src);
          tile.appendChild(vid);

          // Reemplazar el PRIMER bloque de imagen por el video
          const first = gal.querySelector('.bloque-imagen');
          if(first){
            gal.replaceChild(tile, first);
          }else{
            gal.insertBefore(tile, gal.firstChild);
          }

          // Intentar reproducir
          try{ vid.load(); }catch(_e){}
          try{ const p = vid.play(); if(p && p.then) p.catch(()=>{}); }catch(_e){}

          // Click: alternar controles, sin overlay
          vid.addEventListener('click', ()=>{ vid.controls = !vid.controls; }, {passive:true});
        }
      }
    }catch(_e){ /* silencioso */ }
    // === fin sustituci√≥n de imagen por video ===
    // --- Video handicap (arriba-derecha) ---
    try {
  if (habitacion && (habitacion.discapacidad === true)) {
    const v = (window.VIDEOS_HAB && window.VIDEOS_HAB[num]) || window.HANDICAP_VIDEO_URL || "";
    setVideoHabitacion(v);

    // üü¢ Autoplay + mute aqu√≠
    const video = document.querySelector("#video-mp4");
    if(video){
      video.muted = true;        // üîá requerido en m√≥viles
      video.setAttribute("muted","");
      video.playsInline = true;  // evita fullscreen en iOS
      video.autoplay = true;     // autoplay
      video.loop = true;         // üîÅ se repite al terminar
      video.currentTime = 0;

      const p = video.play();
      if(p && typeof p.catch === "function") p.catch(()=>{});
    }

  } else {
    stopVideoHabitacion();
    setVideoHabitacion(""); // oculta
  }
}catch(e){}
} else {
      panel.innerHTML = `
        <div class="contenido-inferior">
          <p>üîç Informaci√≥n no disponible para la habitaci√≥n ${num}.</p>
          <button class="btn-volver" onclick="cerrarPanelInferior()">Cerrar</button>
        </div>
      `;
    }

    panel.style.display = "block";
    document.body.style.overflow = "hidden";
  } catch (error) {
    panel.innerHTML = `
      <div class="contenido-inferior">
        <p>‚ö†Ô∏è Error al cargar la informaci√≥n. Intenta de nuevo.</p>
        <button class="btn-volver" onclick="cerrarPanelInferior()">Cerrar</button>
      </div>
    `;
    panel.style.display = "block";
    document.body.style.overflow = "hidden";
  }
}

function cerrarPanelInferior() {
  const panel = document.getElementById("panelInferior");
  const mensaje = document.getElementById("mensajeSeleccion");

  panel.style.display = "none";
  document.body.style.overflow = "auto";

  if (mensaje) mensaje.style.display = "block";
}

async function marcarHabitacionesDisponibles() {
  try {
    const response = await fetch("habitaciones.json");
    const data = await response.json();
    const botones = document.querySelectorAll(".habitacion-btn");

    botones.forEach(boton => {
const num = boton.dataset.num || boton.textContent.trim();
      const habitacion = data[num];

      if (habitacion) {
        boton.classList.add("disponible");

        // Determinar tipo de cama
        const tipoCama = habitacion.tipo_cama === "K" ? "K" : "D";

        if (habitacion.tipo_cama === "K") {
  boton.classList.add("tipo-k");
} else if (habitacion.tipo_cama === "D") {
  boton.classList.add("tipo-d");


}


        // Verificar si tiene sof√° cama
const sofaIcon = `
  ${habitacion.sofa ? '<img loading="lazy" src="https://res.cloudinary.com/dor6za85u/image/upload/v1753173371/sof%C3%A0_pzyjdc.png" style="height: 18px; vertical-align: middle;" />' : ''}
  ${habitacion.discapacidad ? '<span style="font-size: 1.2em;">‚ôø</span>' : ''}
`;

        // Crear nuevo contenido
        boton.innerHTML = `
          <div style="display: flex; flex-direction: column; align-items: center;">
            <div>${num}</div>
            <div style="font-size: 0.9em;">${tipoCama}${sofaIcon}</div>
          </div>
        `;
      }
    });
  } catch (error) {
    console.error("Error al cargar habitaciones disponibles:", error);
  }
}

// Ejecutar al cargar
window.addEventListener("DOMContentLoaded", marcarHabitacionesDisponibles);

    let datosActuales = {}; // Aqu√≠ guardaremos los datos iniciales para comparar m√°s adelante

document.addEventListener("DOMContentLoaded", () => {
  const botones = document.querySelectorAll(".habitacion-btn");
  botones.forEach(boton => {
    boton.addEventListener("click", () => {
      const num = boton.dataset.num;
      mostrarInfo(num);
    });
  });
});

// Drag-scroll solo una vez
const zona = document.querySelector('.zona-desplazable');
let isDown = false, startX, scrollLeft;

zona.addEventListener('mousedown', (e) => {
  isDown = true;
  zona.classList.add('arrastrando');
  startX = e.pageX - zona.offsetLeft;
  scrollLeft = zona.scrollLeft;
});
zona.addEventListener('mouseleave', () => { isDown = false; zona.classList.remove('arrastrando'); });
zona.addEventListener('mouseup', () => { isDown = false; zona.classList.remove('arrastrando'); });
zona.addEventListener('mousemove', (e) => {
  if (!isDown) return;
  e.preventDefault();
  const x = e.pageX - zona.offsetLeft;
  zona.scrollLeft = scrollLeft - (x - startX);
});

    async function actualizarHabitacionesSilenciosamente() {
  try {
    const response = await fetch("habitaciones.json");
    const nuevosDatos = await response.json();
    const botones = document.querySelectorAll(".habitacion-btn");

    botones.forEach(boton => {
      const num = boton.dataset.num || boton.textContent.trim();
      const nuevaData = nuevosDatos[num];
      const actualData = datosActuales[num];

      if (nuevaData && JSON.stringify(nuevaData) !== JSON.stringify(actualData)) {
        const tipoCama = nuevaData.tipo_cama === "K" ? "K" : "D";

if (nuevaData.tipo_cama === "K") {
  boton.classList.add("tipo-k");
} else if (nuevaData.tipo_cama === "D") {
  boton.classList.add("tipo-d");
}

        const sofaIcon = `
          ${nuevaData.sofa ? '<img loading="lazy" src="https://res.cloudinary.com/dor6za85u/image/upload/v1753173371/sof%C3%A0_pzyjdc.png" style="height: 18px; vertical-align: middle;" />' : ''}
          ${nuevaData.discapacidad ? '<span style="font-size: 1.2em;">‚ôø</span>' : ''}
        `;

        boton.innerHTML = `
          <div style="display: flex; flex-direction: column; align-items: center;">
            <div>${num}</div>
            <div style="font-size: 0.9em;">${tipoCama}${sofaIcon}</div>
          </div>
        `;

        boton.classList.add("disponible");
      }
    });

    datosActuales = nuevosDatos;

  } catch (error) {
    console.warn("No se pudo actualizar habitaciones en segundo plano:", error);
  }
}
setInterval(actualizarHabitacionesSilenciosamente, 5000); // Se actualiza cada 5 segundos

document.addEventListener('DOMContentLoaded', async () => {
  const sel = document.getElementById('filtro-categoria');
  const btnClear = document.getElementById('btn-limpiar-filtro');
  const totalEl = document.getElementById('total-coincidencias-categoria');

  let habitacionesData = null;

  // Cargar JSON de habitaciones
  async function cargarHabitaciones() {
    if (!habitacionesData) {
      const resp = await fetch('habitaciones.json');
      habitacionesData = await resp.json();
    }
    return habitacionesData;
  }

  // Llenar select con categor√≠as
  async function initCategorias() {
    const data = await cargarHabitaciones();
    const categorias = new Set(Object.values(data).map(h => h.categoria).filter(Boolean));
    [...categorias].sort().forEach(cat => {
      const opt = document.createElement('option');
      opt.value = cat;
      opt.textContent = cat;
      sel.appendChild(opt);
    });
  }

  // Aplicar filtro visual
  async function aplicarFiltro(categoria) {
  const data = await cargarHabitaciones();
  let count = 0;

  // Quitamos espacios y normalizamos
  const catSel = (categoria || '').trim();

  document.querySelectorAll('.habitacion-btn').forEach(btn => {
    const num = btn.dataset.num || btn.textContent.trim();
    const habitacion = data[num];
    const catHab = ((habitacion && habitacion.categoria) || '').trim();

    if (catSel) {
      // Si hay una categor√≠a seleccionada, comparar
      const coincide = catHab.toLowerCase() === catSel.toLowerCase();
      btn.classList.toggle('filtro-activo', coincide);
      btn.classList.toggle('filtro-inactivo', !coincide);
      if (coincide) count++;
    } else {
      // Si est√° en "Todas", limpiar clases
      btn.classList.remove('filtro-activo', 'filtro-inactivo');
      count++;
    }
  });

  totalEl.textContent = count;
}

  // Eventos
  sel.addEventListener('change', e => aplicarFiltro(e.target.value));
  btnClear.addEventListener('click', () => {
    sel.value = '';
    aplicarFiltro('');
  });

  // Inicializar
  await initCategorias();
  aplicarFiltro('');
});
    </script>  <!-- ‚úÖ Cierra aqu√≠ tu script principal -->

<div id="modal-mejoras" class="modal-mejoras" role="dialog" aria-modal="true" aria-labelledby="titulo-novedades">
  <div class="modal-contenido">
    <h2>üÜïBIENVENID@ - Novedades del Cat√°logo</h2>
    <ul>
      <li>‚ú® Panel de filtrado de categor√≠as mejorado.</li>
      <li>üíì Animaci√≥n de latido para habitaciones filtradas.</li>
      <li>üåó Oscurecido de habitaciones no coincidentes.</li>
      <li>üè∑Ô∏è Nuevo t√≠tulo elegante con logo de Paradisus.</li>
      <li> üëå Gracias por ser parte de la Mejoraüòä.</li>
    </ul>
    <button id="cerrar-modal">Cerrar</button>
  </div>
</div>

<!-- Script del modal -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('modal-mejoras');
  const btnCerrar = document.getElementById('cerrar-modal');

  modal.classList.add('activo');

  btnCerrar.addEventListener('click', () => {
    modal.classList.remove('activo');
  });

  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.remove('activo');
    }
  });
});
</script>
    <script>
function hacerZoom(src) {
  const overlay = document.getElementById('zoom-overlay');
  const img = document.getElementById('zoom-img');
  img.src = src;
  overlay.style.display = 'flex';        // mostrar
  overlay.classList.remove('visor-oculto');
  overlay.setAttribute('aria-hidden', 'false');
}  
function cerrarZoom(event) {
  const overlay = document.getElementById('zoom-overlay');
  // Cerrar si: no hay evento, o se hace clic en el fondo, o en el bot√≥n de cerrar
  if (!event || event.target === overlay || event.target.id === 'zoom-close') {
    overlay.style.display = 'none';      // ocultar
    overlay.classList.add('visor-oculto');
    overlay.setAttribute('aria-hidden', 'true');
    document.getElementById('zoom-img').src = '';
  }
}

// Cerrar con tecla ESC
document.addEventListener('keydown', (ev) => {
  if (ev.key === 'Escape') cerrarZoom();
});
</script>



<script>
// ===== Carga JSON (tal cual) =====
window.habitacionesData = window.habitacionesData || null;
async function ensureHabitacionesData(){
  if(!window.habitacionesData){
    const resp = await fetch('habitaciones.json', {cache:'no-store'});
    window.habitacionesData = await resp.json();
  }
  return window.habitacionesData;
}

// ===== Utilidades espec√≠ficas a tu JSON =====
function getTipoCama(h){
  // En tu JSON viene como "K" o "D" (campo tipo_cama)
  const v = (h.tipo_cama || '').toString().toUpperCase();
  if (v === 'K' || v === 'D') return v;
  // Fallback por si un d√≠a viene texto
  const txt = [h.titulo||'', h.descripcion||'', ...(h.caracteristicas||[])].join(' ').toUpperCase();
  if (/\bKING\b|KING SIZE|\bKS\b/.test(txt)) return 'K';
  if (/\bDOUBLE\b|\bDOBLE\b|\bMATRIMONIAL\b|\bMATRI\b|2\s*DBL/.test(txt)) return 'D';
  return '';
}

function prefijoRecepcion(h){
  // Deriva C/S del c√≥digo en el t√≠tulo (C2V, C2W, S6E, SE1, SE2, SE4, ...)
  const t = (h.titulo || '').toUpperCase();
  const m = t.match(/\b([CS](?:E)?\d*[A-Z]?)\b/); // S6E, SE1, C2V, C2W...
  if (m && m[1]) return m[1].startsWith('S') ? 'S' : 'C';
  // Fallback: por categor√≠a
  const cat = (h.categoria||'').toLowerCase();
  return cat.includes('the reserve') ? 'S' : 'C';
}

function esHandicap(h){
  // Tu JSON trae booleano 'discapacidad'
  return h.discapacidad === true;
}

function tieneCocineta(h){
  if (h.cocineta === true) return true;
  const list = (h.caracteristicas || []).map(x => String(x).toLowerCase());
  return list.some(x => /\bcocineta\b|kitchenette|\bcocina\b/.test(x));
}

function torreDe(numStr){
  const s = String(numStr).trim();
  const t = parseInt(s[0], 10);
  return [1,2,3,4].includes(t) ? t : 0;
}

// ===== Refs =====
const selCategoria = document.getElementById('filtro-categoria');
const selCama      = document.getElementById('filtro-cama');
const selPrefijo   = document.getElementById('filtro-prefijo');
const cbHandicap   = document.getElementById('filtro-handicap');
const cbCocineta   = document.getElementById('filtro-cocineta');
const coincidenciasEl = document.getElementById('total-coincidencias-categoria');
const resumenEl    = document.getElementById('totales-resumen');
const tablaEl      = document.getElementById('totales-tabla');

function renderTabla(stats){
  if(!tablaEl) return;
  const t = stats.towers;
  tablaEl.innerHTML = `
    <table>
      <thead><tr><th>Torre</th><th>K</th><th>D</th><th>Total</th></tr></thead>
      <tbody>
        ${[1,2,3,4].map(i => `
          <tr><td>${i}</td><td>${t[i].K}</td><td>${t[i].D}</td><td><strong>${t[i].total}</strong></td></tr>
        `).join('')}
      </tbody>
    </table>`;
}

async function aplicarFiltrosBoss(){
  const data = await ensureHabitacionesData();
  const categoria = (selCategoria?.value || '').trim().toLowerCase();
  const cama      = (selCama?.value || '').toUpperCase();   // "" | K | D
  const prefijo   = (selPrefijo?.value || '').toUpperCase(); // "" | C | S
  const fHC       = !!cbHandicap?.checked;
  const fCoc      = !!cbCocineta?.checked;

  let matches = 0;
  const stats = {
    overall:{K:0,D:0,total:0},
    towers:{1:{K:0,D:0,total:0},2:{K:0,D:0,total:0},3:{K:0,D:0,total:0},4:{K:0,D:0,total:0}},
    flags:{reserve:0, handicap:0, cocineta:0}
  };

  // Recorremos cada bot√≥n de habitaci√≥n
  document.querySelectorAll('.habitacion-btn').forEach(btn => {
    const num = btn.dataset.num || btn.textContent.trim();
    const h = data[num];
    if(!h){ btn.classList.add('filtro-inactivo'); btn.classList.remove('filtro-activo'); return; }

    let ok = true;
    if(categoria){ ok = ok && ((h.categoria||'').toLowerCase() === categoria); }
    if(cama){
      const tc = getTipoCama(h);
      ok = ok && (tc === cama);
    }
    if(prefijo){
      const p = prefijoRecepcion(h);
      ok = ok && (p === prefijo);
    }
    if(fHC){ ok = ok && esHandicap(h); }
    if(fCoc){ ok = ok && tieneCocineta(h); }

    btn.classList.toggle('filtro-inactivo', !ok);
    btn.classList.toggle('filtro-activo', ok);

    if(ok){
      matches++;
      const kd = (getTipoCama(h) === 'K') ? 'K' : 'D';
      stats.overall[kd]++; stats.overall.total++;
      const t = torreDe(num);
      if(t){ stats.towers[t][kd]++; stats.towers[t].total++; }
      if (prefijoRecepcion(h) === 'S') stats.flags.reserve++;
      if (esHandicap(h)) stats.flags.handicap++;
      if (tieneCocineta(h)) stats.flags.cocineta++;
    }
  });

  if(coincidenciasEl) coincidenciasEl.textContent = matches;
  if(resumenEl) resumenEl.textContent =
    `K: ${stats.overall.K} ¬∑ D: ${stats.overall.D} ¬∑ Total: ${stats.overall.total} ‚Äî `+
    `Reserve: ${stats.flags.reserve} ¬∑ ‚ôø: ${stats.flags.handicap} ¬∑ Cocineta: ${stats.flags.cocineta}`;
  renderTabla(stats);
}

// Eventos
[selCategoria, selCama, selPrefijo, cbHandicap, cbCocineta].forEach(el => {
  if(el) el.addEventListener('change', aplicarFiltrosBoss);
});
document.getElementById('btn-limpiar-filtro')?.addEventListener('click', () => {
  if(selCategoria) selCategoria.value = '';
  if(selCama) selCama.value = '';
  if(selPrefijo) selPrefijo.value = '';
  if(cbHandicap) cbHandicap.checked = false;
  if(cbCocineta) cbCocineta.checked = false;
  aplicarFiltrosBoss();
});

document.addEventListener('DOMContentLoaded', aplicarFiltrosBoss);

// === Video helpers (handicap) ===
function stopVideoHabitacion(){
  try{
    const iframe = document.getElementById('video-embed');
    const mp4 = document.getElementById('video-mp4');
    if (mp4){ mp4.pause?.(); mp4.removeAttribute('src'); mp4.load?.(); }
    if (iframe){ iframe.src = ''; }
  }catch(e){}
}
function normalizarEmbed(u){
  try{
    if(u.includes('youtu.be/')){ const id = u.split('/').pop().split(/[?&#]/)[0]; return `https://www.youtube.com/embed/${id}`; }
    if(u.includes('watch?v=')){ const id = new URL(u).searchParams.get('v'); return `https://www.youtube.com/embed/${id}`; }
    if(u.includes('youtube.com/embed/')) return u;
    if(u.includes('vimeo.com/')){ const id = u.split('/').pop().split(/[?&#]/)[0]; return `https://player.vimeo.com/video/${id}`; }
  }catch(e){}
  return u;
}

function setVideoHabitacion(url){
  const box = document.getElementById('video-habitacion');
  const iframe = document.getElementById('video-embed');
  const mp4 = document.getElementById('video-mp4');
  if(!box || !iframe || !mp4) return;

  // Reset
  box.hidden = true;
  iframe.hidden = true; iframe.src = "";
  mp4.hidden = true; mp4.removeAttribute('src'); mp4.load?.();

  if(!url) return;

  const u = String(url).trim();
  if(/youtu\.be|youtube\.com|vimeo\.com/i.test(u)){
    iframe.src = normalizarEmbed(u);
    iframe.hidden = false;
    box.hidden = false;
    return;
  }
  if(/\.(mp4)(\?|#|$)/i.test(u)){
    mp4.src = u;
    mp4.hidden = false;
    box.hidden = false;

    // Click abre zoom como las im√°genes
    try{ mp4.onclick = (ev)=>{ ev.stopPropagation(); abrirZoomVideo(mp4.currentSrc || mp4.src); }; }catch(_e){}
    return;
  }
}

// Mapa de videos por habitaci√≥n (handicap)
window.VIDEOS_HAB = window.VIDEOS_HAB || {
  "4318": "https://res.cloudinary.com/dor6za85u/video/upload/v1754942483/Ba%C3%B1o_Handicap_i1r6cg.mp4", // pega aqu√≠ el enlace del video
  "4321": "https://res.cloudinary.com/dor6za85u/video/upload/v1754942483/Ba%C3%B1o_Handicap_i1r6cg.mp4", // pega aqu√≠ el enlace del video
  "4325": "https://res.cloudinary.com/dor6za85u/video/upload/v1754942483/Ba%C3%B1o_Handicap_i1r6cg.mp4", // pega aqu√≠ el enlace del video
  "4328": ""  // pega aqu√≠ el enlace del video
};
// URL por defecto si quieres usar 1 solo video para las 4
window.HANDICAP_VIDEO_URL = "https://res.cloudinary.com/dor6za85u/video/upload/v1754942483/Ba%C3%B1o_Handicap_i1r6cg.mp4"; // <-- opcional: pega aqu√≠ un enlace (YouTube/Vimeo o .mp4)


// === Zoom de Video ===
function abrirZoomVideo(src){
  const overlay = document.getElementById('video-zoom-overlay');
  const zv = document.getElementById('zoom-video');
  if(!overlay || !zv) return;
  // reset
  zv.pause?.(); zv.removeAttribute('src'); zv.load?.();
  zv.setAttribute('playsinline','');
  zv.setAttribute('muted',''); // autoplay seguro; usuario puede activar sonido
  zv.setAttribute('autoplay','');
  zv.muted = true;
  zv.src = src;
  overlay.classList.add('activo');
  overlay.setAttribute('aria-hidden','false');
  const p = zv.play?.(); if (p && typeof p.catch==='function') p.catch(()=>{});
}
function cerrarZoomVideo(){
  const overlay = document.getElementById('video-zoom-overlay');
  const zv = document.getElementById('zoom-video');
  if(!overlay || !zv) return;
  zv.pause?.(); zv.removeAttribute('src'); zv.load?.();
  overlay.classList.remove('activo');
  overlay.setAttribute('aria-hidden','true');
}
// cerrar por click fuera o ESC
document.addEventListener('DOMContentLoaded', () => {
  const overlay = document.getElementById('video-zoom-overlay');
  overlay?.addEventListener('click', (e)=>{ if(e.target===overlay) cerrarZoomVideo(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') cerrarZoomVideo(); });
});

</script>

<!-- Overlay de ZOOM para video -->
<div id="video-zoom-overlay" class="video-zoom-overlay" aria-hidden="true">
  <video id="zoom-video" controls playsinline muted></video>
</div>


<!-- Fallback inteligente para descargar el PDF en GitHub Pages -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.getElementById('btn-descargar-pdf');
  if (!btn) return;

  const base = new URL('.', location.href).href;

  const candidates = [
    'introduccion_paradisus_2025.pdf',
    'Introducci√≥n Proyecto Cat√°logo de Habitaciones ¬∑ Paradisus desarrollado por Luis Hernaldo 2025.pdf',
    'Introduccion Proyecto Catalogo de Habitaciones - Paradisus desarrollado por Luis Hernaldo 2025.pdf',
    'assets/introduccion_paradisus_2025.pdf',
    'pdf/introduccion_paradisus_2025.pdf'
  ];

  async function headOk(url){
    try{
      const res = await fetch(url, { method:'HEAD', cache:'no-store' });
      return res.ok;
    }catch(_){ return false; }
  }

  btn.addEventListener('click', async (e) => {
    // Permite ctrl/cmd click normal
    if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
    e.preventDefault();

    for (const c of candidates){
      const url = new URL(encodeURI(c), base).href;
      if (await headOk(url)){
        window.open(url, '_blank', 'noopener');
        return;
      }
    }
    alert('No se encontr√≥ el PDF. Sube una copia llamada "introduccion_paradisus_2025.pdf" en el mismo folder del index o usa la carpeta assets/pdf indicada.');
  });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function() {
    const videos = document.querySelectorAll(".modal-contenido video");
    videos.forEach(video => {
        video.addEventListener("click", () => {
            video.classList.toggle("zoomed");
        });
    });
});
</script>


<script>
(function() {
  try {
    var modal = document.getElementById('modal-mejoras');
    var btnCerrar = document.getElementById('cerrar-modal');
    if (modal && btnCerrar) {
      var observer = new MutationObserver(function(muts){
        for (var i=0; i<muts.length; i++) {
          if (muts[i].attributeName === 'class') {
            var c = modal.className || '';
            if (c.indexOf('abierto') !== -1) {
              setTimeout(function(){ try { btnCerrar.focus(); } catch(e){} }, 0);
            }
          }
        }
      });
      observer.observe(modal, { attributes: true });
    }
  } catch(e) {}
})();
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.habitacion-btn').forEach(btn => {
    const n = btn.getAttribute('data-num') || btn.textContent.trim();
    if(n && !btn.hasAttribute('onclick')){
      btn.setAttribute('onclick', `mostrarInfo('${n}')`);
    }
  });
  // ESC to close zoom if function exists
  document.addEventListener('keydown', e=>{
    if(e.key === 'Escape' && typeof cerrarZoom === 'function'){ cerrarZoom(e); }
  });
});
</script>

<script>
/* === HK Sesi√≥n e Inventario (5h) === */
(function(){
  const SESSION_KEY = 'hk_inv_session';
  const TTL = 5*60*60*1000; // 5 horas
  const MATRICULAS = {
    '3068694':'Dolores',
    '3071925':'Itzel',
    '3075393':'Marisela',
    '3077512':'Ximena',
    '3072167':'Luis',
    '3062148':'Silvia',
    '3067888':'Manuel'
  };
  function now(){ return Date.now(); }
  function hasSession(){
    const t = +sessionStorage.getItem(SESSION_KEY) || 0;
    return (now() - t) < TTL;
  }
  function setSession(){ sessionStorage.setItem(SESSION_KEY, String(now())); updateSessionUI(); }
  function clearSession(){ sessionStorage.removeItem(SESSION_KEY); updateSessionUI(); }

  window.hkHasSession = hasSession;
  window.updateSessionUI = function(){
    const btnLogout = document.getElementById('btn-logout');
    if(btnLogout) btnLogout.style.display = hasSession() ? 'inline-flex' : 'none';
  };

  // Modal visual del PIN
  function pedirPINModal(){
    return new Promise((resolve)=>{
      const OV  = document.getElementById('hkpin2');
      const INP = document.getElementById('hkpin2-input');
      const OK  = document.getElementById('hkpin2-ok');
      const CAN = document.getElementById('hkpin2-cancel');
      const TOG = document.getElementById('hkpin2-toggle');
      const CLR = document.getElementById('hkpin2-clear');
      const ERR = document.getElementById('hkpin2-error');
      function open(){ OV.classList.add('activo'); OV.setAttribute('aria-hidden','false'); ERR.style.display='none'; INP.value=''; INP.type='password'; INP.focus(); document.addEventListener('keydown', onkey); }
      function close(){ OV.classList.remove('activo'); OV.setAttribute('aria-hidden','true'); document.removeEventListener('keydown', onkey); }
      function onkey(e){ if(e.key==='Escape'){ close(); resolve(null); } if(e.key==='Enter'){ OK.click(); } }
      function onok(){ const v=(INP.value||'').trim(); if(!v){ ERR.style.display='block'; return; } close(); resolve(v); }
      function oncancel(){ close(); resolve(null); }
      function ontoggle(){ INP.type = (INP.type==='password' ? 'text' : 'password'); }
      function onclear(){ INP.value=''; INP.focus(); }
      OK.addEventListener('click', onok, {once:true});
      CAN.addEventListener('click', oncancel, {once:true});
      TOG.addEventListener('click', ontoggle);
      CLR.addEventListener('click', onclear);
      open();
    });
  }

  window.hkLogin = async function(next){
    if(hasSession()){ if(typeof next==='function') next(); return; }
    const pin = await pedirPINModal();
    if(!pin) return;
    const id = String(pin).trim();
    const name = MATRICULAS[id] || null;
    if(name){
      try{ sessionStorage.setItem('HK_MAT', id); sessionStorage.setItem('HK_NAME', name); }catch(e){}
      setSession();
      if(typeof next==='function') next();
    }else{
      const ERR = document.getElementById('hkpin2-error'); if(ERR){ ERR.style.display='block'; }
    }
  };

  window.hkLogout = function(){
    clearSession();
    try{ sessionStorage.removeItem('HK_MAT'); sessionStorage.removeItem('HK_NAME'); }catch(e){}
    const inv = document.getElementById('inventarioOverlay'); if(inv) inv.classList.remove('activo');
  };

  // Inventario principal (overlay)
  window.abrirInventarioPrincipal = function(habitacionNum){
    let ov = document.getElementById('inventarioOverlay');
    if(!ov){
      ov = document.createElement('div');
      ov.id = 'inventarioOverlay';
      ov.className = 'modal-mejoras'; // reutiliza estilo de overlay existente
      ov.innerHTML = '<div class="modal-contenido"><h2 id="inv-titulo"></h2><div id="inv-body"></div></div>';
      document.body.appendChild(ov);
    }
    const titulo = ov.querySelector('#inv-titulo');
    const body = ov.querySelector('#inv-body');
    if(titulo) titulo.textContent = 'Inventario ¬∑ ' + habitacionNum;

    // Construir formulario largo
    const name = sessionStorage.getItem('HK_NAME') || 'equipo';
    body.innerHTML = `
      <div class="invp-wrap">
        <div class="invp-head">
          <div>Hola, <strong>${name}</strong> ‚Äî ¬øqu√© registramos hoy?</div>
          <label style="display:flex;align-items:center;gap:6px;font-size:12px;">
            <input id="invp-hide-hist" type="checkbox"> Ocultar historial
          </label>
        </div>
        <div id="invp-histbox" class="invp-hist">No hay historial a√∫n.</div>

        <div class="invp-section">Cantidad de sillas</div>
        <div class="invp-row">
          <div class="invp-counter">
            <button type="button" id="sillas-menos">‚àí</button>
            <input id="sillas-cant" type="number" value="0" min="0">
            <button type="button" id="sillas-mas">+</button>
          </div>
        </div>

        <div class="invp-section">üõèÔ∏è Cama</div>
        <div class="invp-box">
          <div class="invp-row">
            <label for="tipo-cama">Tipo de cama</label>
            <select id="tipo-cama">
              <option value="K" selected>K ‚Äî 1 cama king</option>
              <option value="D">D ‚Äî 2 camas</option>
            </select>
          </div>
          <div class="invp-row"><label>Protector</label><input id="cama-protector" type="number" value="1" min="0"></div>
          <div class="invp-row"><label>S√°banas</label><input id="cama-sabanas" type="number" value="1" min="0"></div>
          <div class="invp-row"><label>Almohadas</label><input id="cama-almohadas" type="number" value="2" min="0"></div>
          <div class="invp-row"><label>Fundas</label><input id="cama-fundas" type="number" value="2" min="0"></div>
          <div class="invp-row"><label>Protector de almohadas</label><input id="cama-prot-alm" type="number" value="2" min="0"></div>
          <div class="invp-row"><label>Inserto (d√∫vet)</label><input id="cama-inserto" type="number" value="1" min="0"></div>
          <div class="invp-row"><label>Cubre d√∫vet</label><input id="cama-cubre" type="number" value="1" min="0"></div>
          <div class="invp-row">
            <label>Color (cubre d√∫vet)</label>
            <select id="cama-color">
              <option value="Blanco" selected>Blanco</option>
              <option value="Caf√©">Caf√©</option>
            </select>
          </div>
        </div>

        <div class="invp-section">üß≥ Cl√≥set</div>
        <div class="invp-box">
          <div class="invp-row"><label>Cobertor</label><input id="clo-cobertor" type="number" value="1" min="0"></div>
          <div class="invp-row"><label>Almohada matrimonial</label><input id="clo-alm-mat" type="number" value="1" min="0"></div>
          <div class="invp-row"><label>Funda matrimonial</label><input id="clo-funda-mat" type="number" value="1" min="0"></div>
          <div class="invp-row"><label>Protector matrimonial</label><input id="clo-prot-mat" type="number" value="1" min="0"></div>
          <div class="invp-row"><label>Bolsa de tela</label><input id="clo-bolsa" type="number" value="1" min="0"></div>
        </div>

        <div class="invp-section">üöø Ba√±o</div>
        <div class="invp-box">
          <div class="invp-row">
            <label for="ban-categoria">Categor√≠a</label>
            <select id="ban-categoria">
              <option value="Normal" selected>Normal</option>
              <option value="Swing Up">Swing Up</option>
              <option value="Master Suite">Master Suite</option>
            </select>
          </div>
          <div class="invp-row"><label>Toallas de ba√±o</label><input id="ban-bano" type="number" value="4" min="0"></div>
          <div class="invp-row"><label>Toallas de mano</label><input id="ban-mano" type="number" value="4" min="0"></div>
          <div class="invp-row"><label>Toallas faciales</label><input id="ban-facial" type="number" value="2" min="0"></div>
          <div class="invp-row"><label>Tapetes</label><input id="ban-tapete" type="number" value="1" min="0"></div>
          <div class="invp-row"><label>Toallas verdes de alberca</label><input id="ban-verdes" type="number" value="0" min="0"></div>
          <div class="invp-row">
            <label>Color (toallas/tapetes)</label>
            <select id="ban-color">
              <option value="Blanco" selected>Blanco</option>
              <option value="Caf√©">Caf√©</option>
            </select>
          </div>
          <div class="invp-note">Normal: sin verdes. Swing/Master: caf√©s y 2 verdes en bolsa de playa.</div>
        </div>

        <div class="invp-section">Notas</div>
        <textarea id="invp-notas" class="invp-textarea" placeholder="Observaciones (opcional)"></textarea>

        <div class="invp-actions">
          <button type="button" class="btn-cancel" onclick="document.getElementById('inventarioOverlay').classList.remove('activo')">Cancelar</button>
          <button id="invp-guardar" type="button" class="btn-ok">Guardar</button>
        </div>
      </div>
    `;

    // Inicializar controles
    (function invpInit(hnum){
      const minus = document.getElementById('sillas-menos');
      const plus  = document.getElementById('sillas-mas');
      const input = document.getElementById('sillas-cant');
      if(minus && input){ minus.onclick = ()=>{ input.stepDown(); }; }
      if(plus  && input){ plus.onclick  = ()=>{ input.stepUp();  }; }
      const hide = document.getElementById('invp-hide-hist');
      const hist = document.getElementById('invp-histbox');
      if(hide && hist){ hide.onchange = ()=>{ hist.style.display = hide.checked ? 'none':'block'; }; }
      const save = document.getElementById('invp-guardar');
      if(save){
        save.onclick = ()=>{
          showSuccessModal('Inventario de la habitaci√≥n ' + hnum + ' guardado con √©xito.', function(){
          const ov = document.getElementById('inventarioOverlay');
          if(ov) ov.classList.remove('activo');
          try{ document.body.classList.remove('hk-modal-open'); }catch(e){}
        });
        };
      }
    })(habitacionNum);

    
    // asegurar que el overlay est√© al final del body (top del stack)
    try{ document.body.appendChild(ov); }catch(e){}
    // bloquear cierre por clic fuera (mantener modal hasta Guardar/Cancelar)
    try{
      ov.addEventListener('click', function(e){
        if(e.target === ov){ e.stopPropagation(); e.stopImmediatePropagation(); /* opcional: animaci√≥n */ }
      }, {capture:true});
    }catch(e){}
    // bloquear scroll de fondo mientras est√© abierto
    try{ document.body.classList.add('hk-modal-open'); }catch(e){}

    ov.classList.add('activo');
  };

  // Al cargar, actualiza UI de sesi√≥n
  document.addEventListener('DOMContentLoaded', updateSessionUI);
})();
</script>


<script>
// Utilidad para mostrar el modal de √©xito
(function(){
  window.showSuccessModal = function(message, onClose){
    const ov  = document.getElementById('hkSuccessModal');
    const msg = document.getElementById('hk-success-msg');
    const ok  = document.getElementById('hk-success-ok');
    if(!ov || !msg || !ok){ return alert(message||'Guardado.'); }
    if(message) msg.textContent = message;
    function close(){
      ov.classList.remove('activo'); ov.setAttribute('aria-hidden','true');
      document.removeEventListener('keydown', onkey);
      if(typeof onClose === 'function') onClose();
    }
    function onkey(e){ if(e.key==='Escape' || e.key==='Enter' || e.key===' '){ close(); } }
    ok.onclick = close;
    ov.classList.add('activo'); ov.setAttribute('aria-hidden','false');
    document.addEventListener('keydown', onkey);
  };
})();
</script>


<script>
(function(){ if (window.__hk_concentrado_done) return; window.__hk_concentrado_done = true;

  const API_URL   = "https://script.google.com/macros/s/AKfycbz3bAcBcbSyF3VlIjrXNzoqhR7DMOEAdYU3GFvTAP7MsU18VbQJVzVQbv3VhfLwP2n1nA/exec";
  const API_TOKEN = "PARADISUS_INV_2025_xX7$K9";

  const ADMIN_IDS = { "3072167":"Luis", "3067888":"Manuel" };
  const SUP_IDS   = { "3077512":"Ximena", "3062148":"Silvia", "3071925":"Itzel", "3068694":"Dolores", "3075393":"Marisela" };

  function getRole(){ try{ const id=(sessionStorage.getItem('HK_MAT')||'').trim(); if(ADMIN_IDS[id]) return 'admin'; if(SUP_IDS[id]) return 'supervisor'; }catch(_){} return 'none'; }
  function el(sel,root){ return (root||document).querySelector(sel); }
  function els(sel,root){ return Array.from((root||document).querySelectorAll(sel)); }
  function h(elm,ev,fn){ elm && elm.addEventListener(ev,fn); }

  function hdr(){ return {'Content-Type':'text/plain'}; }
  async function apiList(){
    const r = await fetch(API_URL + '?action=list&token=' + encodeURIComponent(API_TOKEN));
    const j = await r.json(); if(!r.ok || !j || j.status!=='ok') throw new Error((j&&j.error)||'list failed'); return j.rows||[];
  }
  async function apiAppend(entry){
    const r = await fetch(API_URL, { method:'POST', headers: hdr(), body: JSON.stringify({action:'append', token: API_TOKEN, entry}) });
    const j = await r.json(); if(!r.ok || !j || j.status!=='ok') throw new Error((j&&j.error)||'append failed'); return j;
  }

  const QK='HK_INV_QUEUE';
  const qLoad=()=>{ try{return JSON.parse(localStorage.getItem(QK)||'[]');}catch(_){return[];} };
  const qSave=a=>{ try{localStorage.setItem(QK,JSON.stringify(a));}catch(_){} };
  const qPush=x=>{ const a=qLoad(); a.push(x); qSave(a); };
  async function flushQueue(){ const a=qLoad(); if(!a.length) return 0; let keep=[]; for(const it of a){ try{ await apiAppend(it); }catch(_){ keep.push(it); } } qSave(keep); return a.length-keep.length; }

  function collect(hnum){
    function val(id){ const e=el('#'+id); return e?(e.type==='checkbox'? e.checked : e.value):''; }
    return {
      fecha: fmtLocal(window.__TZ_MAZATLAN),
      habitacion: String(hnum||''),
      usuario: sessionStorage.getItem('HK_NAME')||'',
      matricula: sessionStorage.getItem('HK_MAT')||'',
      sillas: val('sillas-cant'),
      cama: {
        tipo:'',
        protector: val('cama-protector'),
        sabana: val('cama-sabanas'),
        almohadas: val('cama-almohadas'),
        fundas: val('cama-fundas'),
        protAlm: val('cama-prot-alm'),
        duvet: val('cama-inserto'),
        fundaDuvet: val('cama-cubre'),
        colorDuvet: val('cama-color')
      },
      closet: { toallasPlaya:'', bolsas:'', ganchos:'', albornoz:'' },
      bano: {
        categoria: val('ban-categoria'), bano: val('ban-bano'), mano: val('ban-mano'),
        facial: val('ban-facial'), tapete: val('ban-tapete'), verdes: val('ban-verdes'), color: val('ban-color')
      },
      notas: val('invp-notas')
    };
  }

  function ensureOverlay(){
    let ov = el('#concentradoOverlay');
    if(!ov){
      ov = document.createElement('div');
      ov.id='concentradoOverlay';
      ov.innerHTML = '\
        <div class="modal-contenido" role="dialog" aria-modal="true">\
          <h2>Concentrado de Inventarios</h2>\
          <div class="conc-toolbar">\
            <div class="left">\
              <input id="conc-search" type="search" placeholder="Buscar habitacion/usuario/nota..." />\
              <div class="conc-stats" id="conc-stats"></div>\
            </div>\
            <div class="right" style="display:flex;gap:8px;align-items:center;flex-shrink:0">\
              <button id="exp-excel" class="btn primary">Exportar Excel</button>\
              <button id="exp-pdf" class="btn primary">Exportar PDF</button>\
              <button id="conc-cerrar" class="btn danger">Cerrar</button>\
            </div>\
          </div>\
          <div class="table-wrap"><div id="conc-body">Cargando...</div></div>\
          <div class="conc-actions" style="display:none"></div>\
        </div>';
      document.body.appendChild(ov);
    }
    return ov;
  }

  function renderTable(rows){
    if(!rows || !rows.length) return '<p>No hay registros todavia.</p>';
    const prefer=['fecha','habitacion','usuario','matricula','estado','anomalias','created_at','updated_at','fecha_servidor','fecha_dia'];
    const keys=Array.from(rows.reduce((s,o)=> (Object.keys(o).forEach(k=>s.add(k)),s), new Set()));
    const headers=prefer.filter(k=>keys.includes(k)).concat(keys.filter(k=>!prefer.includes(k)).sort());
    let th = headers.map(h=>'<th data-key="'+h+'">'+h+'</th>').join('');
    let body = rows.map(r=>'<tr>'+headers.map(h=>'<td>'+(r[h]??'')+'</td>').join('')+'</tr>').join('');
    return '<table class="conc-table"><thead><tr>'+th+'</tr></thead><tbody>'+body+'</tbody></table>';
  }

  function sortByKey(rows, key, dir){
    const m = dir==='desc'?-1:1;
    rows.sort((a,b)=>{ const av=(a[key]??'').toString(); const bv=(b[key]??'').toString(); return av.localeCompare(bv, undefined, {numeric:true})*m; });
  }

  function exportCSV(){
    const ov=el('#concentradoOverlay'); const table=el('.conc-table', ov); let csv='';
    if(table){
      const rows=els('tr', table);
      const cell=td=> (td.innerText||'').replace(/\r?\n/g,' ').trim();
      csv = rows.map(tr => els(':scope > *', tr).map(td => JSON.stringify(cell(td))).join(',')).join('\n');
    } else if (ov && ov.__data){
      const rows = ov.__data||[]; if(!rows.length) return alert('No hay datos.');
      const prefer=['fecha','habitacion','usuario','matricula','estado','anomalias','created_at','updated_at','fecha_servidor','fecha_dia'];
      const set=new Set(); rows.forEach(r=>Object.keys(r).forEach(k=>set.add(k)));
      const headers=prefer.filter(k=>set.has(k)).concat(Array.from(set).filter(k=>!prefer.includes(k)).sort());
      csv = headers.join(',')+'\n'+rows.map(r=>headers.map(h=>JSON.stringify(r[h]??'')).join(',')).join('\n');
    } else return alert('No hay datos.');
    const blob=new Blob(['\ufeff', csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='concentrado_inventario.csv'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000);
  }

  function exportPDF(){
    const ov=el('#concentradoOverlay'); const wrap=el('.table-wrap', ov); const html=wrap?wrap.innerHTML:'<p>Sin datos</p>';
    const w=window.open('', '_blank'); if(!w) return alert('Permite ventanas emergentes para exportar a PDF.');
    const css='<style>body{font-family:Arial,sans-serif;padding:16px}h1{font-size:18px;margin:0 0 10px}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ddd;padding:6px;font-size:12px;white-space:nowrap}th{background:#f3f4f6;position:sticky;top:0}tr:nth-child(even) td{background:#fcfdff}</style>';
    w.document.write('<html><head><meta charset="utf-8"><title>Concentrado</title>'+css+'</head><body><h1>Concentrado de Inventarios</h1>'+html+'<script>

// === Hora local Los Cabos (America/Mazatlan) ===
(function(){
  if (window.__tzHelpersInjected) return; window.__tzHelpersInjected = true;
  window.__TZ_MAZATLAN = 'America/Mazatlan';
  window.fmtLocal = function fmtLocal(tz){
    const parts = new Intl.DateTimeFormat('en-CA', {
      timeZone: tz,
      year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit',
      hour12:false
    }).formatToParts(new Date());
    const get = t => (parts.find(p => p.type === t)||{value:''}).value;
    return `${get('year')}-${get('month')}-${get('day')} ${get('hour')}:${get('minute')}:${get('second')}`;
  };
  window.toMazatlan = function toMazatlan(anyDateStrOrTs){
    try{
      const d = (typeof anyDateStrOrTs==='number') ? new Date(anyDateStrOrTs) : new Date(anyDateStrOrTs);
      const parts = new Intl.DateTimeFormat('es-MX', {
        timeZone: window.__TZ_MAZATLAN,
        year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit', second:'2-digit',
        hour12:false
      }).formatToParts(d);
      const get = t => (parts.find(p => p.type===t)||{value:''}).value;
      return `${get('year')}-${get('month')}-${get('day')} ${get('hour')}:${get('minute')}:${get('second')}`;
    }catch(e){ try{ return String(anyDateStrOrTs||''); }catch(_){ return ''; } }
  };
})();

</script>
</body></html>');
    w.document.close(); w.focus(); w.print();
  }

  async function openConcentrado(){
    if(getRole()!=='admin') return alert('Solo administradores pueden ver el concentrado.');
    const ov=ensureOverlay(); el('#conc-body', ov).innerHTML='<div style="padding:18px">Cargando<span class="spinner"></span></div>';
    ov.classList.add('activo'); ov.setAttribute('aria-hidden','false');
    try{
      const data = await apiList();
      ov.__data = data.slice();
      el('#conc-body', ov).innerHTML = renderTable(ov.__data);
      refreshStats(ov); wireSort(ov);
    }catch(e){
      console.error(e);
      let data=[]; try{ data = JSON.parse(localStorage.getItem('HK_INV_DATA')||'[]'); }catch(_){}
      ov.__data = data;
      el('#conc-body', ov).innerHTML = renderTable(ov.__data);
      refreshStats(ov); wireSort(ov);
    }
  }

  function refreshStats(ov){
    const s = el('#conc-stats', ov);
    const n = (ov.__data||[]).length;
    const last = n? (ov.__data[ov.__data.length-1].fecha_servidor || ov.__data[ov.__data.length-1].created_at || '') : '';
    s.textContent = n + ' registros' + (last ? (' ‚Ä¢ ultimo: ' + last) : '');
  }

  function wireSort(ov){
    const table = el('.conc-table', ov); if(!table) return;
    const headers = els('th', table);
    headers.forEach(th => {
      let dir = 'asc';
      h(th,'click',()=>{ const key=th.getAttribute('data-key'); if(!key) return; sortByKey(ov.__data, key, dir); dir = dir==='asc'?'desc':'asc'; el('#conc-body', ov).innerHTML=renderTable(ov.__data); wireSort(ov); });
    });
  }

  document.addEventListener('input', function(e){
    if(e.target && e.target.id==='conc-search'){
      const term = e.target.value.toLowerCase().trim();
      const ov = el('#concentradoOverlay'); if(!ov || !ov.__data) return;
      const base = ov.__data_all || (ov.__data_all = ov.__data.slice());
      if(!term) ov.__data = base.slice();
      else ov.__data = base.filter(r => JSON.stringify(r).toLowerCase().includes(term));
      el('#conc-body', ov).innerHTML = renderTable(ov.__data);
      wireSort(ov); refreshStats(ov);
    }
  });

  document.addEventListener('click', function(e){
    if(e.target && e.target.id==='btn-concentrado') openConcentrado();
    if(e.target && e.target.id==='conc-cerrar'){ const ov=el('#concentradoOverlay'); if(ov){ ov.classList.remove('activo'); ov.setAttribute('aria-hidden','true'); } }
    if(e.target && e.target.id==='exp-excel') exportCSV();
    if(e.target && e.target.id==='exp-pdf') exportPDF();
  });

  if (typeof window.abrirInventarioPrincipal === 'function'){
    const _open = window.abrirInventarioPrincipal;
    window.abrirInventarioPrincipal = function(hnum){
      _open(hnum);
      setTimeout(function(){
        const save = document.getElementById('invp-guardar');
        if(save && !save.__wired){
          save.__wired = true;
          save.addEventListener('click', async function(){
            try{ const entry = collect(hnum); try{ await apiAppend(entry); }catch(_e){ qPush(entry); } try{ await flushQueue(); }catch(_e){} }catch(err){ console.error(err); }
          }, {capture:true});
        }
      }, 0);
    };
  }

  async function badgeCheck(){
    const bd = document.getElementById('hk-badge'); if(!bd) return;
    bd.style.display = 'inline-block'; bd.textContent = 'Comprobando...';
    try{ await apiList(); bd.textContent='Central'; bd.classList.add('ok'); }
    catch(_e){ bd.textContent='Local'; bd.classList.remove('ok'); }
    if(getRole()!=='admin') bd.style.display='none';
  }

  document.addEventListener('DOMContentLoaded', async function(){
    const btn = document.getElementById('btn-concentrado');
    if(btn) btn.style.display = (getRole()==='admin' ? 'inline-flex' : 'none');
    try{ await flushQueue(); }catch(_){}
    badgeCheck();
  });

})();</script>


<script>
(()=>{
  if(window.__hkRestoreGuardWired) return; window.__hkRestoreGuardWired = true;
  const DEPURACION_MAT = "3072167";                    // matr√≠cula autorizada
  const DEPURACION_PASS = "JRPNLS96050220H500";        // clave de depuraci√≥n

  window.__hkRestoreWithConfirm = function(num, applyFn){
    try{
      if(!confirm("¬øRestaurar valores sugeridos para esta habitaci√≥n?")) return;
      if(!confirm("Esta acci√≥n sobrescribir√° los campos visibles. ¬øConfirmas?")) return;
      const mat = (sessionStorage.getItem('matricula')||'').trim();
      if(mat !== DEPURACION_MAT){ alert("Matr√≠cula no autorizada."); return; }
      const pass = prompt("Clave de depuraci√≥n:");
      if(pass !== DEPURACION_PASS){ alert("Clave incorrecta."); return; }
      if(typeof applyFn === 'function') applyFn(num);
    }catch(e){ console.error(e); alert("No se pudo restaurar los sugeridos."); }
  };
})();
</script>

<script>
(()=>{
  if (window.__hkSugeridosWired) return;
  window.__hkSugeridosWired = true;
  const MASTERS = [3014, 3114, 3214, 4111, 4211, 4311, 4411, 4511];
  const SWING_UP = [3014, 3015, 3016, 3017, 3018, 3019, 3020, 3021, 3022, 3023, 3024, 3025, 3026, 3027, 3028, 3029, 3030, 3101, 3102, 3103, 3104, 3105, 3106, 3107, 3108, 3109, 3110, 3111, 3112];
  const esMaster = n => MASTERS.includes(Number(n));
  const esSwingUp = n => SWING_UP.includes(Number(n)) && !esMaster(n);
  const categoriaDe = n => esMaster(n) ? 'Master Suite' : (esSwingUp(n) ? 'Swing Up' : 'Normal');

  async function getHabitacion(num){
    try{
      if (typeof window.ensureHabitacionesData === 'function'){
        const map = await window.ensureHabitacionesData();
        return map?.[num] || null;
      }
      const data = await fetch('habitaciones.json').then(r=>r.json());
      return data?.[num] || null;
    }catch(_){ return null; }
  }
  function tipoCamaDesdeJson(h){
    if (!h) return '';
    if (typeof window.getTipoCama === 'function') return window.getTipoCama(h);
    const v = (h.tipo_cama||'').toString().toUpperCase();
    if (v==='K' || v==='D') return v;
    const txt = [h.titulo||'', h.descripcion||'', ...(h.caracteristicas||[])].join(' ').toUpperCase();
    if (/\bKING\b|KING SIZE|\bKS\b/.test(txt)) return 'K';
    if (/\bDOUBLE\b|\bDOBLE\b|\bMATRIMONIAL\b|\bMATRI\b|2\s*DBL/.test(txt)) return 'D';
    return '';
  }
  function sugeridos(categoria, tipoCamaNorm='K'){
    const camaK = { protector:1, sabanas:2, almohadas:4, fundas:4, protAlm:4, inserto:1, cubre:1 };
    const camaD = { protector:camaK.protector*2, sabanas:camaK.sabanas*2, almohadas:camaK.almohadas*2, fundas:camaK.fundas*2, protAlm:camaK.protAlm*2, inserto:camaK.inserto*2, cubre:camaK.cubre*2 };
    if (categoria==='Swing Up'){
      return { ban:{bano:6,mano:6,facial:2,tapete:2,verdes:2,color:'Caf√©',lockColor:true},
               cama:{...camaK,color:'Caf√©',tipo:'K',lockTipo:true,lockColor:true} };
    }
    if (categoria==='Master Suite'){
      return { ban:{bano:6,mano:7,facial:2,tapete:4,verdes:2,color:'Caf√©',lockColor:true},
               cama:{...camaK,color:'Caf√©',tipo:'K',lockTipo:true,lockColor:true} };
    }
    const isD = (tipoCamaNorm==='D');
    return { ban:{bano:4,mano:4,facial:2,tapete:1,verdes:0,color:'Blanco',lockColor:false},
             cama:{...(isD?camaD:camaK),color:'Blanco',tipo:(isD?'D':'K'),lockTipo:true,lockColor:false} };
  }
  function setVal(id,v){ const el=document.getElementById(id); if(el) el.value=String(v); }
  function setSel(id,v,lock=false){ const el=document.getElementById(id); if(!el) return; const has=[...el.options].some(o=>o.value==v); el.value=has?v:(el.options[0]?.value||''); lock?el.setAttribute('disabled','disabled'):el.removeAttribute('disabled'); }
  function pintarChip(cat,cama){
    try{
      const head=document.querySelector('#inventarioOverlay .invp-head')||document.querySelector('#inventarioOverlay .modal-contenido h2');
      if(!head) return;
      let chip=document.getElementById('hk-sugeridos-chip');
      if(!chip){
        chip=document.createElement('div'); chip.id='hk-sugeridos-chip'; chip.style.cssText='margin:.5rem 0 0;display:flex;gap:8px;align-items:center;flex-wrap:wrap';
        const badge=document.createElement('span'); badge.id='hk-sugeridos-badge'; badge.style.cssText='display:inline-block;background:#0ea5e9;color:#fff;font-weight:700;border-radius:999px;padding:4px 10px;font-size:12px';
        const btn=document.createElement('button'); btn.type='button'; btn.id='hk-sugeridos-restore'; btn.textContent='Restaurar sugeridos'; btn.style.cssText='border:none;background:#e5e7eb;border-radius:8px;padding:4px 8px;font-size:12px;cursor:pointer';
        chip.appendChild(badge); chip.appendChild(btn); head.parentNode.insertBefore(chip, head.nextSibling);
      }
      const badge=document.getElementById('hk-sugeridos-badge'); if(badge) badge.textContent=`Sugeridos: ${cat} ‚Ä¢ ${cama}`;
    }catch(_){}
  }
  async function aplicarSugeridos(num){
    const h=await getHabitacion(num);
    const cat=categoriaDe(num);
    const tipo=(cat==='Normal')?(tipoCamaDesdeJson(h)||'K'):'K';
    const sug=sugeridos(cat,tipo);
    setVal('ban-bano',sug.ban.bano); setVal('ban-mano',sug.ban.mano); setVal('ban-facial',sug.ban.facial); setVal('ban-tapete',sug.ban.tapete); setVal('ban-verdes',sug.ban.verdes); setSel('ban-color',sug.ban.color,sug.ban.lockColor); setSel('ban-categoria',cat,true);
    setSel('tipo-cama',sug.cama.tipo,sug.cama.lockTipo); setVal('cama-protector',sug.cama.protector); setVal('cama-sabanas',sug.cama.sabanas); setVal('cama-almohadas',sug.cama.almohadas); setVal('cama-fundas',sug.cama.fundas); setVal('cama-prot-alm',sug.cama.protAlm); setVal('cama-inserto',sug.cama.inserto); setVal('cama-cubre',sug.cama.cubre); setSel('cama-color',sug.cama.color,sug.cama.lockColor);
    pintarChip(cat,(cat==='Normal'?tipo:'K'));
    const btn=document.getElementById('hk-sugeridos-restore'); if(btn){ btn.onclick=()=> window.__hkRestoreWithConfirm(num, aplicarSugeridos); }
  }
  function tryWire(){
    if(typeof window.abrirInventarioPrincipal!=='function') return;
    if(window.__hkSugeridosHooked) return; window.__hkSugeridosHooked=true;
    const _open=window.abrirInventarioPrincipal;
    window.abrirInventarioPrincipal=function(num){ _open(num); setTimeout(()=>{ aplicarSugeridos(num); },0); };
  }
  tryWire(); document.addEventListener('DOMContentLoaded', tryWire);
})();
</script>

<script>
(()=>{
  if(window.__hkConcFsWired) return; window.__hkConcFsWired = true;

  function placeBtn(ov){
    const toolbar = ov.querySelector('.conc-toolbar .right') || ov.querySelector('.conc-toolbar') || ov;
    if(!toolbar) return false;
    if(document.getElementById('conc-fullscreen-btn')) return true;

    const btn = document.createElement('button');
    btn.id = 'conc-fullscreen-btn';
    btn.type = 'button';
    btn.textContent = 'Expandir';
    btn.className = 'btn success';
    btn.style.cssText = 'margin-left:8px;background:#10b981;color:#fff;border:none;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer;';
    btn.onclick = () => {
      const on = ov.classList.toggle('fullscreen');
      document.body.classList.toggle('hk-no-scroll', on);
      btn.textContent = on ? 'Salir de pantalla completa' : 'Expandir';
    };

    const closeBtn = ov.querySelector('#conc-cerrar');
    if(closeBtn && closeBtn.parentNode){
      closeBtn.parentNode.insertBefore(btn, closeBtn);
    }else{
      toolbar.appendChild(btn);
    }
    return true;
  }

  function ensureFsButton(){
    const ov = document.getElementById('concentradoOverlay');
    if(!ov) return;
    placeBtn(ov);
  }

  function hookOpen(){
    if(typeof window.openConcentrado!=='function') return;
    if(window.__hkConcFsHooked) return; window.__hkConcFsHooked = true;
    const _open = window.openConcentrado;
    window.openConcentrado = async function(){
      const r = await _open.apply(this, arguments);
      setTimeout(ensureFsButton, 0);
      return r;
    };
  }

  const mo = new MutationObserver(()=> ensureFsButton());
  mo.observe(document.documentElement, { childList:true, subtree:true });

  hookOpen();
  document.addEventListener('DOMContentLoaded', hookOpen);
  ensureFsButton();
})();
</script>

<script>
(()=>{
  if(window.__hkConcPurgeWired) return; window.__hkConcPurgeWired = true;
  const DEPURACION_MAT = "3072167";
  const DEPURACION_PASS = "JRPNLS96050220H500";

  function purgeUI(){
    try{
      const ov = document.getElementById('concentradoOverlay');
      const tbody = ov && ov.querySelector('table tbody');
      if(!tbody) return false;
      tbody.innerHTML = "";
      const counter = ov.querySelector('.conc-count');
      if(counter) counter.textContent = "0 registros";
      return true;
    }catch(e){ console.error(e); return false; }
  }

  async function purgeBackendMaybe(){
    try{
      if (typeof window.apiPurge === 'function'){
        const ok = await window.apiPurge();
        return !!ok;
      }
      if (window.__conc_api_base){
        const url = window.__conc_api_base + "?mode=purge";
        const r = await fetch(url, {method:"POST"});
        const j = await r.json().catch(()=>null);
        return j && j.status === "ok";
      }
    }catch(e){ console.warn("purgeBackendMaybe:", e); }
    return false;
  }

  window.__hkPurgeWithConfirm = async function(){
    try{
      if(!confirm("¬øEliminar/depurar el historial mostrado en Concentrado?")) return;
      if(!confirm("Esta acci√≥n no se puede deshacer. ¬øConfirmas?")) return;
      const mat = (sessionStorage.getItem('matricula')||'').trim();
      if(mat !== DEPURACION_MAT){ alert("Matr√≠cula no autorizada."); return; }
      const pass = prompt("Clave de depuraci√≥n:");
      if(pass !== DEPURACION_PASS){ alert("Clave incorrecta."); return; }
      let done = await purgeBackendMaybe();
      const uiDone = purgeUI();
      if(done || uiDone){
        alert(done ? "Historial eliminado (servidor) y limpiado en la vista." : "Historial limpiado en la vista (solo UI).");
      }else{
        alert("No se pudo depurar el historial.");
      }
    }catch(e){ console.error(e); alert("No se pudo depurar el historial."); }
  };

  function placeBtn(){
    const ov = document.getElementById('concentradoOverlay');
    if(!ov) return;
    const toolbar = ov.querySelector('.conc-toolbar .right') || ov.querySelector('.conc-toolbar') || ov;
    if(!toolbar) return;
    if(document.getElementById('conc-purge-btn')) return;

    const btn = document.createElement('button');
    btn.id = 'conc-purge-btn';
    btn.type = 'button';
    btn.textContent = 'Depurar';
    btn.className = 'btn danger';
    btn.style.cssText = 'background:#ef4444;color:#fff;border:none;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer;';
    btn.onclick = ()=> window.__hkPurgeWithConfirm();

    const closeBtn = toolbar.querySelector('#conc-cerrar');
    if (closeBtn && closeBtn.parentNode === toolbar){
      toolbar.insertBefore(btn, closeBtn);
    }else{
      toolbar.appendChild(btn);
    }
  }

  function hookOpen(){
    if(typeof window.openConcentrado!=='function') return;
    if(window.__hkConcPurgeHooked) return; window.__hkConcPurgeHooked = true;
    const _open = window.openConcentrado;
    window.openConcentrado = async function(){
      const r = await _open.apply(this, arguments);
      setTimeout(placeBtn, 0);
      return r;
    };
  }

  const mo = new MutationObserver(()=> placeBtn());
  mo.observe(document.documentElement, { childList:true, subtree:true });

  document.addEventListener('DOMContentLoaded', hookOpen);
  hookOpen();
  placeBtn();
})();
</script>

<script>
(()=>{
  if(window.__hkPurgeModalWired) return; window.__hkPurgeModalWired = true;

  const AUTH_MAT  = "3072167";
  const AUTH_PASS = "JRPNLS96050220H500";

  async function purgeBackendMaybe(){
    try{
      if (typeof window.apiPurge === 'function'){
        const ok = await window.apiPurge();
        return !!ok;
      }
      if (window.__conc_api_base){
        const url = window.__conc_api_base + "?mode=purge";
        const r = await fetch(url, {method:"POST"});
        const j = await r.json().catch(()=>null);
        return j && j.status === "ok";
      }
    }catch(e){ console.warn("purgeBackendMaybe:", e); }
    return false;
  }

  function purgeUI(){
    try{
      const ov = document.getElementById('concentradoOverlay');
      const tbody = ov && ov.querySelector('table tbody');
      if(!tbody) return false;
      tbody.innerHTML = "";
      const counter = ov.querySelector('.conc-count');
      if(counter) counter.textContent = "0 registros";
      return true;
    }catch(e){ console.error(e); return false; }
  }

  function openModal(){
    const mask = document.createElement('div');
    mask.className = 'hk-purge-mask';
    mask.innerHTML = `
      <div class="hk-purge-dialog" role="dialog" aria-modal="true" aria-labelledby="hk-purge-title">
        <h3 id="hk-purge-title">Depurar / Eliminar historial</h3>
        <p class="desc">Esta acci√≥n elimina el historial mostrado en <b>Concentrado</b>.</p>
        <div class="warn">‚ö†Ô∏è No se puede deshacer.</div>
        <div class="row">
          <div style="flex:1">
            <label for="pmat">Matr√≠cula</label>
            <input id="pmat" type="text" placeholder="Ingresa tu matr√≠cula">
          </div>
          <div style="flex:1">
            <label for="ppass">Clave de depuraci√≥n</label>
            <input id="ppass" type="password" placeholder="Clave">
          </div>
        </div>
        <div class="confirm">
          <input id="pchk" type="checkbox">
          <label for="pchk">Entiendo que esta acci√≥n no se puede deshacer</label>
        </div>
        <div id="perr" class="error"></div>
        <div class="actions">
          <button class="btn-cancel" id="pcancel" type="button">Cancelar</button>
          <button class="btn-go" id="pgo" type="button" disabled>Eliminar</button>
        </div>
      </div>
    `;

    function close(){ mask.remove(); }

    mask.querySelector('#pchk').addEventListener('change', (e)=>{
      mask.querySelector('#pgo').disabled = !e.target.checked;
    });

    mask.querySelector('#pgo').addEventListener('click', async ()=>{
      const mat = mask.querySelector('#pmat').value.trim();
      const pass = mask.querySelector('#ppass').value.trim();
      const err = mask.querySelector('#perr');

      if(mat !== AUTH_MAT){ err.textContent = "Matr√≠cula no autorizada."; return; }
      if(pass !== AUTH_PASS){ err.textContent = "Clave incorrecta."; return; }
      err.textContent = "";

      const btn = mask.querySelector('#pgo');
      btn.disabled = true; btn.textContent = "Eliminando‚Ä¶";

      let okServer = await purgeBackendMaybe();
      let okUI = purgeUI();

      btn.disabled = false; btn.textContent = "Eliminar";

      if(okServer || okUI){
        mask.querySelector('.desc').innerHTML = "<b>Historial eliminado.</b>";
        mask.querySelector('.warn').style.display = "none";
        btn.style.display = "none";
        mask.querySelector('#pcancel').textContent = "Cerrar";
      }else{
        err.textContent = "No se pudo depurar el historial.";
      }
    });

    mask.querySelector('#pcancel').addEventListener('click', close);
    mask.addEventListener('click', (e)=>{ if(e.target === mask) close(); });

    document.body.appendChild(mask);
    setTimeout(()=> mask.querySelector('#pmat').focus(), 0);
  }

  function wireBtn(){
    const btn = document.getElementById('conc-purge-btn');
    if(btn && !btn.dataset.purgeModal){
      btn.dataset.purgeModal = '1';
      btn.onclick = (ev)=>{ ev.preventDefault(); openModal(); };
    }
  }

  const mo = new MutationObserver(wireBtn);
  mo.observe(document.documentElement, { childList:true, subtree:true });
  document.addEventListener('DOMContentLoaded', wireBtn);
  wireBtn();
})();
</script>
<script>

// === Hora local Los Cabos (America/Mazatlan) ===
(function(){
  if (window.__tzHelpersInjected) return; window.__tzHelpersInjected = true;
  window.__TZ_MAZATLAN = 'America/Mazatlan';
  window.fmtLocal = function fmtLocal(tz){
    const parts = new Intl.DateTimeFormat('en-CA', {
      timeZone: tz,
      year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit',
      hour12:false
    }).formatToParts(new Date());
    const get = t => (parts.find(p => p.type === t)||{value:''}).value;
    return `${get('year')}-${get('month')}-${get('day')} ${get('hour')}:${get('minute')}:${get('second')}`;
  };
  window.toMazatlan = function toMazatlan(anyDateStrOrTs){
    try{
      const d = (typeof anyDateStrOrTs==='number') ? new Date(anyDateStrOrTs) : new Date(anyDateStrOrTs);
      const parts = new Intl.DateTimeFormat('es-MX', {
        timeZone: window.__TZ_MAZATLAN,
        year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit', second:'2-digit',
        hour12:false
      }).formatToParts(d);
      const get = t => (parts.find(p => p.type===t)||{value:''}).value;
      return `${get('year')}-${get('month')}-${get('day')} ${get('hour')}:${get('minute')}:${get('second')}`;
    }catch(e){ try{ return String(anyDateStrOrTs||''); }catch(_){ return ''; } }
  };
})();

</script>
</body>
</html>
